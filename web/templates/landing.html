<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ethara AI × ARC</title>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Press+Start+2P&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap");

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            :root {
                --bg: #0e1117;
                --panel: #161b22;
                --panel2: #1c2129;
                --border: #30363d;
                --text: #c9d1d9;
                --text-dim: #8b949e;
                --text-bright: #f0f6fc;
                --accent: #58a6ff;
                --green: #3fb950;
                --green-dim: #238636;
                --purple: #bc8cff;
                --purple-dim: rgba(188, 140, 255, 0.15);
                --orange: #f0883e;
                --red: #f85149;
                --mono: "Share Tech Mono", "Courier New", monospace;
                --pixel: "Press Start 2P", monospace;
                --sans: "Inter", sans-serif;
                --code: "JetBrains Mono", monospace;
            }

            html,
            body {
                height: 100%;
                overflow: hidden;
                background: transparent;
                color: var(--text);
                font-family: var(--mono);
            }

            /* ═══ BACKGROUND LAYER (behind grid) ═══ */
            .bg-layer {
                position: fixed;
                inset: 0;
                background: var(--bg);
                z-index: -3;
            }

            /* ═══ TOP BAR ═══ */
            #topbar {
                display: flex;
                align-items: center;
                gap: 16px;
                padding: 0 28px;
                background: rgba(22, 27, 34, 0.65);
                backdrop-filter: blur(12px);
                border-bottom: 1px solid rgba(48, 54, 61, 0.6);
                height: 48px;
                flex-shrink: 0;
                z-index: 100;
                position: relative;
            }
            .logo {
                font-family: var(--pixel);
                font-size: 11px;
                color: var(--accent);
                white-space: nowrap;
                text-decoration: none;
                cursor: pointer;
            }
            .sep {
                width: 1px;
                height: 20px;
                background: var(--border);
            }
            .tagline {
                font-size: 12px;
                color: var(--text-dim);
            }
            .spacer {
                flex: 1;
            }

            /* ═══ TOP BAR BUTTONS ═══ */
            .top-btn {
                font-family: var(--code);
                font-size: 10px;
                padding: 6px 14px;
                border-radius: 6px;
                border: 1px solid var(--border);
                background: transparent;
                color: var(--text-dim);
                cursor: pointer;
                transition: all 0.15s;
                text-decoration: none;
                white-space: nowrap;
            }
            .top-btn:hover {
                border-color: var(--accent);
                color: var(--text-bright);
                background: rgba(88, 166, 255, 0.06);
            }
            .top-btn-admin {
                color: var(--orange);
                border-color: rgba(240, 136, 62, 0.3);
            }
            .top-btn-admin:hover {
                border-color: var(--orange);
                background: rgba(240, 136, 62, 0.08);
                color: var(--orange);
            }
            .top-btn-admin.active {
                background: rgba(240, 136, 62, 0.12);
                border-color: var(--orange);
                color: var(--orange);
                box-shadow: 0 0 10px rgba(240, 136, 62, 0.15);
            }
            .top-btn-logout {
                color: var(--red);
                border-color: rgba(248, 81, 73, 0.3);
            }
            .top-btn-logout:hover {
                border-color: var(--red);
                background: rgba(248, 81, 73, 0.08);
            }

            /* ═══ ADMIN LOGIN MODAL ═══ */
            #admin-modal {
                display: none;
                position: fixed;
                inset: 0;
                z-index: 1000;
                background: rgba(0, 0, 0, 0.7);
                backdrop-filter: blur(6px);
                align-items: center;
                justify-content: center;
            }
            #admin-modal.show {
                display: flex;
            }
            .admin-box {
                background: var(--panel);
                border: 1px solid var(--border);
                border-radius: 14px;
                padding: 32px;
                width: 360px;
                max-width: 90vw;
                display: flex;
                flex-direction: column;
                gap: 18px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            }
            .admin-box h2 {
                font-family: var(--pixel);
                font-size: 13px;
                color: var(--orange);
                text-align: center;
                letter-spacing: 1px;
            }
            .admin-input {
                width: 100%;
                padding: 10px 14px;
                font-family: var(--code);
                font-size: 12px;
                color: var(--text);
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 6px;
                outline: none;
                transition:
                    border-color 0.2s,
                    box-shadow 0.2s;
            }
            .admin-input:focus {
                border-color: var(--orange);
                box-shadow: 0 0 0 3px rgba(240, 136, 62, 0.12);
            }
            .admin-input::placeholder {
                color: #444;
            }
            .admin-submit {
                width: 100%;
                padding: 10px;
                font-family: var(--pixel);
                font-size: 10px;
                letter-spacing: 1px;
                color: #fff;
                background: linear-gradient(135deg, var(--orange), #e06820);
                border: none;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.2s;
            }
            .admin-submit:hover {
                box-shadow: 0 4px 20px rgba(240, 136, 62, 0.3);
                transform: translateY(-1px);
            }
            .admin-submit:disabled {
                opacity: 0.5;
                cursor: default;
                transform: none;
                box-shadow: none;
            }
            .admin-status {
                font-family: var(--code);
                font-size: 11px;
                text-align: center;
                min-height: 16px;
            }
            .admin-status.err {
                color: var(--red);
            }
            .admin-status.ok {
                color: var(--green);
            }
            .admin-cancel {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                background: none;
                border: none;
                cursor: pointer;
                text-align: center;
                padding: 4px;
            }
            .admin-cancel:hover {
                color: var(--text-bright);
            }

            /* ═══ CARD DELETE BADGE (admin mode) ═══ */
            .card-delete-btn {
                display: none;
                position: absolute;
                top: 8px;
                right: 8px;
                z-index: 20;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                border: 2px solid var(--red);
                background: rgba(248, 81, 73, 0.15);
                color: var(--red);
                font-size: 14px;
                cursor: pointer;
                align-items: center;
                justify-content: center;
                transition: all 0.15s;
                backdrop-filter: blur(4px);
                line-height: 1;
            }
            .card-delete-btn:hover {
                background: var(--red);
                color: #fff;
                box-shadow: 0 0 16px rgba(248, 81, 73, 0.4);
                transform: scale(1.1);
            }
            body.admin-mode .card-delete-btn {
                display: flex;
            }

            /* ═══ TOAST NOTIFICATION ═══ */
            #toast {
                position: fixed;
                bottom: 24px;
                left: 50%;
                transform: translateX(-50%) translateY(80px);
                z-index: 2000;
                font-family: var(--code);
                font-size: 12px;
                padding: 10px 24px;
                border-radius: 8px;
                background: var(--panel2);
                color: var(--text-bright);
                border: 1px solid var(--border);
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
                opacity: 0;
                transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
                pointer-events: none;
                white-space: nowrap;
            }
            #toast.show {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            #toast.toast-ok {
                border-color: var(--green);
                color: var(--green);
            }
            #toast.toast-err {
                border-color: var(--red);
                color: var(--red);
            }

            /* ═══ APP LAYOUT ═══ */
            #app {
                display: flex;
                flex-direction: column;
                height: 100vh;
                position: relative;
                z-index: 0;
                background: transparent;
            }
            #content {
                flex: 1;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                min-height: 0;
                position: relative;
                z-index: 0;
                background: transparent;
            }

            /* ═══ ANIMATED PERSPECTIVE GRID BACKGROUND (arcprize.org style) ═══ */
            .grid-bg {
                position: fixed;
                left: 0;
                right: 0;
                bottom: 0;
                top: auto;
                width: 100%;
                height: 70vh;
                overflow: hidden;
                perspective: 56.25vh;
                z-index: -2;
                pointer-events: none;
            }
            .grid-bg-lines {
                position: absolute;
                left: 0;
                top: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                height: 200%;
                background-image:
                    linear-gradient(
                        to right,
                        rgba(88, 166, 255, 0.35) 1px,
                        transparent 0
                    ),
                    linear-gradient(
                        to bottom,
                        rgba(88, 166, 255, 0.35) 1px,
                        transparent 0
                    );
                background-size: 4vh 3vh;
                background-repeat: repeat;
                transform-origin: 100% 0 0;
                animation: gridPlay 30s linear infinite;
            }
            @keyframes gridPlay {
                0% {
                    transform: rotateX(45deg) translateY(-50%);
                }
                100% {
                    transform: rotateX(45deg) translateY(0);
                }
            }
            /* Mask: fades grid at top and radial vignette */
            .grid-fade {
                position: fixed;
                left: 0;
                top: 0;
                right: 0;
                bottom: 0;
                background-color: transparent;
                background-image:
                    linear-gradient(180deg, var(--bg) 25%, transparent),
                    radial-gradient(
                        circle farthest-corner at 50% 0%,
                        transparent 60%,
                        var(--bg) 95%
                    );
                z-index: -1;
                pointer-events: none;
            }
            /* Subtle horizon glow line */
            .grid-glow {
                position: fixed;
                bottom: 30%;
                left: 0;
                width: 100%;
                height: 2px;
                z-index: -1;
                pointer-events: none;
                background: linear-gradient(
                    90deg,
                    transparent 5%,
                    rgba(88, 166, 255, 0.18) 30%,
                    rgba(188, 140, 255, 0.22) 50%,
                    rgba(63, 185, 80, 0.18) 70%,
                    transparent 95%
                );
                box-shadow:
                    0 0 30px 8px rgba(88, 166, 255, 0.08),
                    0 0 60px 16px rgba(188, 140, 255, 0.04);
                animation: glowPulse 4s ease-in-out infinite alternate;
            }
            @keyframes glowPulse {
                0% {
                    opacity: 0.5;
                }
                100% {
                    opacity: 1;
                }
            }

            /* ═══ SECTION PANELS (top / bottom) ═══ */
            .section-panel {
                flex: 1;
                display: flex;
                flex-direction: column;
                min-height: 0;
                overflow: hidden;
                position: relative;
                z-index: 0;
                background: transparent;
            }

            /* ── Thick visual divider between sections ── */
            .section-divider {
                flex-shrink: 0;
                height: 3px;
                background: linear-gradient(
                    90deg,
                    var(--purple) 0%,
                    var(--accent) 50%,
                    var(--green) 100%
                );
                box-shadow:
                    0 0 12px rgba(88, 166, 255, 0.3),
                    0 0 24px rgba(88, 166, 255, 0.1);
                position: relative;
                z-index: 2;
            }

            /* ═══ SECTION HEADER ═══ */
            .section-header {
                flex-shrink: 0;
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 8px 20px 6px;
                border-bottom: 1px solid rgba(48, 54, 61, 0.6);
                background: rgba(22, 27, 34, 0.55);
                backdrop-filter: blur(10px);
            }

            /* ── Large prominent badge ── */
            .section-badge {
                font-family: var(--pixel);
                font-size: 13px;
                letter-spacing: 2px;
                padding: 8px 18px;
                border-radius: 6px;
                white-space: nowrap;
                flex-shrink: 0;
                text-transform: uppercase;
            }
            .badge-purple {
                background: linear-gradient(
                    135deg,
                    rgba(188, 140, 255, 0.2),
                    rgba(188, 140, 255, 0.08)
                );
                color: var(--purple);
                border: 2px solid rgba(188, 140, 255, 0.5);
                box-shadow:
                    0 0 16px rgba(188, 140, 255, 0.2),
                    inset 0 0 12px rgba(188, 140, 255, 0.06);
            }
            .badge-green {
                background: linear-gradient(
                    135deg,
                    rgba(63, 185, 80, 0.2),
                    rgba(63, 185, 80, 0.08)
                );
                color: var(--green);
                border: 2px solid rgba(63, 185, 80, 0.5);
                box-shadow:
                    0 0 16px rgba(63, 185, 80, 0.2),
                    inset 0 0 12px rgba(63, 185, 80, 0.06);
            }

            /* ── Title + count ── */
            .section-title-group {
                display: flex;
                flex-direction: column;
                gap: 2px;
                flex-shrink: 0;
            }
            .section-title {
                font-family: var(--pixel);
                font-size: 14px;
                color: var(--text-bright);
                letter-spacing: 0.5px;
            }
            .section-subtitle {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .section-count {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                opacity: 0.8;
            }

            .section-desc {
                font-size: 11px;
                color: var(--text-dim);
                line-height: 1.5;
                flex: 1;
                min-width: 120px;
            }

            /* ── Category tabs ── */
            .cat-tabs {
                display: flex;
                gap: 2px;
                flex-shrink: 0;
                background: rgba(255, 255, 255, 0.03);
                border-radius: 6px;
                padding: 3px;
            }
            .cat-tab {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                background: none;
                border: none;
                border-radius: 4px;
                padding: 6px 14px;
                cursor: pointer;
                transition: all 0.15s;
                display: flex;
                align-items: center;
                gap: 6px;
                white-space: nowrap;
            }
            .cat-tab:hover {
                color: var(--text-bright);
                background: rgba(255, 255, 255, 0.04);
            }
            .cat-tab.active {
                color: var(--purple);
                background: rgba(188, 140, 255, 0.1);
                box-shadow: 0 0 0 1px rgba(188, 140, 255, 0.3);
            }
            .cat-tab .ct-count {
                font-size: 9px;
                background: rgba(255, 255, 255, 0.06);
                color: inherit;
                padding: 1px 6px;
                border-radius: 8px;
                opacity: 0.7;
            }
            .cat-tab.active .ct-count {
                background: rgba(188, 140, 255, 0.2);
                opacity: 1;
            }

            /* ── Controls (search, upload, pagination) ── */
            .section-controls {
                display: flex;
                align-items: center;
                gap: 10px;
                flex-shrink: 0;
                margin-left: auto;
            }
            .search-box {
                width: 200px;
                padding: 7px 12px;
                font-family: var(--code);
                font-size: 11px;
                color: var(--text);
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 6px;
                outline: none;
                transition:
                    border-color 0.2s,
                    box-shadow 0.2s;
            }
            .search-box:focus {
                border-color: var(--accent);
                box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
            }
            .search-box::placeholder {
                color: #444;
            }

            .upload-btn {
                font-family: var(--code);
                font-size: 10px;
                padding: 7px 14px;
                background: transparent;
                border: 1px dashed var(--border);
                color: var(--text-dim);
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.15s;
                white-space: nowrap;
                display: inline-flex;
                align-items: center;
                gap: 5px;
            }
            .upload-btn:hover {
                border-color: var(--accent);
                color: var(--text-bright);
                background: rgba(88, 166, 255, 0.05);
            }
            .upload-btn input[type="file"] {
                display: none;
            }

            .pag-row {
                display: flex;
                align-items: center;
                gap: 6px;
                flex-shrink: 0;
            }
            .pag-btn {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                background: var(--panel2);
                border: 1px solid var(--border);
                border-radius: 4px;
                padding: 4px 10px;
                cursor: pointer;
                transition: all 0.15s;
            }
            .pag-btn:hover:not(:disabled) {
                border-color: var(--accent);
                color: var(--text-bright);
            }
            .pag-btn:disabled {
                color: #333;
                cursor: default;
                border-color: rgba(48, 54, 61, 0.4);
            }
            .pag-info {
                font-family: var(--code);
                font-size: 10px;
                color: #555;
            }

            /* ═══ CAROUSEL ═══ */
            .carousel-wrapper {
                flex: 1;
                display: flex;
                align-items: center;
                overflow: hidden;
                min-height: 0;
                position: relative;
                padding: 0 8px;
                background: transparent;
            }

            .carousel-btn {
                flex-shrink: 0;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                border: 1px solid var(--border);
                background: rgba(22, 27, 34, 0.7);
                backdrop-filter: blur(4px);
                color: var(--text-dim);
                font-size: 20px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.15s;
                z-index: 5;
                user-select: none;
            }
            .carousel-btn:hover:not(:disabled) {
                border-color: var(--accent);
                color: var(--text-bright);
                background: var(--panel2);
                box-shadow: 0 0 12px rgba(88, 166, 255, 0.15);
            }
            .carousel-btn:disabled {
                opacity: 0.2;
                cursor: default;
            }

            .carousel-track {
                flex: 1;
                display: flex;
                gap: 20px;
                overflow-x: auto;
                overflow-y: hidden;
                scroll-behavior: smooth;
                padding: 16px 14px;
                min-height: 0;
                align-items: center;
                justify-content: center;
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .carousel-track::-webkit-scrollbar {
                display: none;
            }
            /* When cards overflow, align to start for scroll */
            .carousel-track.has-overflow {
                justify-content: flex-start;
            }

            /* ═══ GAME / TASK CARD ═══ */
            .g-card {
                flex-shrink: 0;
                width: 155px;
                height: 205px;
                background: rgba(22, 27, 34, 0.9);
                border: 1px solid rgba(255, 255, 255, 0.07);
                cursor: pointer;
                transition: all 0.2s ease;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                position: relative;
                border-radius: 6px;
                box-shadow: 0 1px 6px rgba(0, 0, 0, 0.35);
            }
            .g-card:hover {
                transform: translateY(-3px);
            }
            .g-card.agi3-card:hover {
                border-color: rgba(63, 185, 80, 0.45);
                box-shadow:
                    0 6px 24px rgba(63, 185, 80, 0.15),
                    0 0 0 1px rgba(63, 185, 80, 0.1);
            }
            .g-card.agi2-card:hover {
                border-color: rgba(188, 140, 255, 0.45);
                box-shadow:
                    0 6px 24px rgba(188, 140, 255, 0.15),
                    0 0 0 1px rgba(188, 140, 255, 0.1);
            }

            /* ── Card Preview ── */
            .g-card-preview {
                position: relative;
                width: 100%;
                flex: 1;
                min-height: 0;
                background: #080b10;
                overflow: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
                border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            }
            .g-card-preview img,
            .g-card-preview canvas {
                width: 100%;
                height: 100%;
                object-fit: contain;
                image-rendering: pixelated;
                image-rendering: crisp-edges;
                transition: transform 0.3s ease;
            }
            .g-card:hover .g-card-preview img,
            .g-card:hover .g-card-preview canvas {
                transform: scale(1.04);
            }
            .g-card-preview .loading-text {
                font-family: var(--code);
                font-size: 11px;
                color: #2a2e36;
                letter-spacing: 3px;
                text-transform: uppercase;
            }

            /* Play overlay */
            .card-overlay {
                position: absolute;
                inset: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(6, 8, 12, 0.55);
                opacity: 0;
                transition: opacity 0.2s ease;
            }
            .g-card:hover .card-overlay {
                opacity: 1;
            }
            .play-circle {
                width: 34px;
                height: 34px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 14px;
                color: #fff;
                transition: transform 0.2s ease;
            }
            .agi3-play {
                background: rgba(63, 185, 80, 0.2);
                border: 2px solid rgba(63, 185, 80, 0.6);
                box-shadow: 0 0 16px rgba(63, 185, 80, 0.2);
            }
            .agi2-play {
                background: rgba(188, 140, 255, 0.15);
                border: 2px solid rgba(188, 140, 255, 0.6);
                box-shadow: 0 0 16px rgba(188, 140, 255, 0.2);
            }
            .g-card:hover .play-circle {
                transform: scale(1.08);
            }

            /* ── Card Info ── */
            .g-card-info {
                padding: 6px 8px;
                display: flex;
                flex-direction: column;
                gap: 3px;
                background: rgba(22, 27, 34, 0.7);
                flex-shrink: 0;
                min-height: 46px;
            }
            .g-card-id {
                font-family: var(--pixel);
                font-size: 9px;
                letter-spacing: 0.5px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .agi3-card .g-card-id {
                color: var(--green);
            }
            .agi2-card .g-card-id {
                color: var(--purple);
            }

            .g-card-tags {
                display: flex;
                flex-wrap: wrap;
                gap: 5px;
            }
            .g-tag {
                font-family: var(--code);
                font-size: 9px;
                padding: 2px 6px;
                border-radius: 3px;
                letter-spacing: 0.3px;
            }
            .agi3-card .g-tag {
                background: rgba(63, 185, 80, 0.08);
                border: 1px solid rgba(63, 185, 80, 0.18);
                color: rgba(63, 185, 80, 0.8);
            }
            .agi2-card .g-tag {
                background: rgba(188, 140, 255, 0.08);
                border: 1px solid rgba(188, 140, 255, 0.18);
                color: rgba(188, 140, 255, 0.8);
            }

            /* ── Empty state ── */
            .empty-msg {
                flex-shrink: 0;
                padding: 30px 20px;
                color: var(--text-dim);
                font-size: 12px;
                line-height: 1.6;
                text-align: center;
                width: 100%;
            }
            .empty-msg code {
                font-family: var(--code);
                background: rgba(255, 255, 255, 0.06);
                padding: 2px 6px;
                border-radius: 3px;
            }

            /* ═══ FOOTER ═══ */
            #footer {
                padding: 6px 28px;
                text-align: center;
                border-top: 1px solid rgba(48, 54, 61, 0.6);
                font-size: 10px;
                color: var(--text-dim);
                flex-shrink: 0;
                background: rgba(22, 27, 34, 0.55);
                backdrop-filter: blur(12px);
                position: relative;
                z-index: 0;
            }
            #footer a {
                color: var(--accent);
                text-decoration: none;
            }
            #footer a:hover {
                text-decoration: underline;
            }

            /* ═══════════════════════════════════════════════════════
               RESPONSIVE — mobile-first progressive enhancement
               Breakpoints:
                 ≤ 359px  — tiny phones (SE 1st gen, Galaxy Fold closed)
                 ≤ 479px  — small phones (iPhone SE, Galaxy S)
                 ≤ 599px  — phones (iPhone 14, Pixel 7)
                 ≤ 767px  — large phones / small tablets portrait
                 ≤ 899px  — tablets portrait (iPad Mini)
                 ≤ 1099px — tablets landscape / small laptops
                 ≤ 1399px — laptops / small desktops
                 ≥ 1400px — large desktops (default styles)
               ═══════════════════════════════════════════════════════ */

            /* ── Large desktop tweaks (>1400) — make cards wider ── */
            @media (min-width: 1400px) {
                .g-card {
                    width: 180px;
                    height: 238px;
                }
                .carousel-track {
                    gap: 22px;
                    padding: 16px 14px;
                }
            }

            /* ── Laptops / small desktops (≤1399) ── */
            @media (max-width: 1399px) {
                .section-header {
                    padding: 6px 16px 5px;
                    gap: 10px;
                }
                .section-desc {
                    display: none;
                }
                .section-badge {
                    font-size: 11px;
                    padding: 5px 10px;
                }
                .section-title {
                    font-size: 13px;
                }
                .cat-tab {
                    font-size: 10px;
                    padding: 4px 9px;
                }
                .g-card {
                    width: 150px;
                    height: 198px;
                }
                .carousel-track {
                    gap: 18px;
                    padding: 14px 12px;
                }
            }

            /* ── Smaller desktops / large laptops (≤1199) ── */
            @media (max-width: 1199px) {
                .section-header {
                    gap: 8px;
                    padding: 5px 14px 4px;
                }
                .section-badge {
                    font-size: 10px;
                    padding: 4px 9px;
                }
                .section-title {
                    font-size: 12px;
                }
                .cat-tab {
                    font-size: 10px;
                    padding: 4px 8px;
                }
                .g-card {
                    width: 140px;
                    height: 185px;
                }
                .carousel-track {
                    gap: 16px;
                    padding: 12px 10px;
                }
                .play-circle {
                    width: 32px;
                    height: 32px;
                    font-size: 13px;
                }
                .carousel-btn {
                    width: 32px;
                    height: 32px;
                    font-size: 16px;
                }
            }

            /* ── Tablets landscape / small laptops (≤1099) ── */
            @media (max-width: 1099px) {
                .section-header {
                    gap: 6px 8px;
                    padding: 5px 12px 4px;
                    flex-wrap: wrap;
                }
                .section-controls {
                    width: 100%;
                    order: 10;
                    margin-left: 0;
                    gap: 6px;
                }
                .section-badge {
                    font-size: 10px;
                    padding: 4px 8px;
                }
                .section-title {
                    font-size: 11px;
                }
                .section-subtitle {
                    font-size: 9px;
                }
                .cat-tabs {
                    flex-wrap: wrap;
                }
                .cat-tab {
                    font-size: 9px;
                    padding: 3px 7px;
                }
                .upload-btn {
                    font-size: 9px;
                    padding: 4px 8px;
                }
                .g-card {
                    width: 130px;
                    height: 172px;
                }
                .carousel-track {
                    gap: 14px;
                    padding: 10px 8px;
                }
                .g-card-info {
                    padding: 5px 6px;
                    gap: 3px;
                    min-height: 42px;
                }
                .play-circle {
                    width: 30px;
                    height: 30px;
                    font-size: 12px;
                }
                .carousel-btn {
                    width: 28px;
                    height: 28px;
                    font-size: 14px;
                }
            }

            /* ── Tablets portrait / small tablets (≤899) ── */
            @media (max-width: 899px) {
                #topbar {
                    padding: 0 14px;
                    gap: 10px;
                    height: 42px;
                }
                .logo {
                    font-size: 10px;
                }
                .tagline {
                    font-size: 10px;
                }
                .section-header {
                    gap: 6px 8px;
                    padding: 8px 12px 6px;
                }
                .section-badge {
                    font-size: 10px;
                    padding: 5px 10px;
                }
                .section-title {
                    font-size: 11px;
                }
                .section-subtitle {
                    font-size: 9px;
                }
                .section-controls {
                    gap: 6px;
                }
                .search-box {
                    min-width: 0;
                    font-size: 10px;
                    padding: 6px 10px;
                }
                .cat-tab {
                    font-size: 10px;
                    padding: 4px 10px;
                }
                .g-card {
                    width: 120px;
                    height: 160px;
                }
                .carousel-track {
                    gap: 12px;
                    padding: 8px 6px;
                }
                .carousel-btn {
                    width: 32px;
                    height: 32px;
                    font-size: 16px;
                }
                .g-card-info {
                    padding: 4px 5px;
                    gap: 3px;
                    min-height: 38px;
                }
                .g-card-id {
                    font-size: 9px;
                }
                .play-circle {
                    width: 28px;
                    height: 28px;
                    font-size: 12px;
                }
                .random-btn {
                    width: 32px;
                    height: 32px;
                    font-size: 14px;
                }
                #footer {
                    padding: 5px 14px;
                    font-size: 9px;
                }
                .upload-box {
                    padding: 24px;
                    width: 420px;
                    max-width: 92vw;
                    border-radius: 10px;
                }
                .kb-box {
                    padding: 22px;
                    width: 380px;
                    max-width: 92vw;
                    border-radius: 10px;
                }
                .admin-box {
                    padding: 24px;
                    max-width: 92vw;
                    border-radius: 10px;
                }
                .upload-btn {
                    font-size: 9px;
                    padding: 5px 9px;
                }
                .pag-btn {
                    padding: 3px 8px;
                    font-size: 10px;
                }
            }

            /* ── Large phones / small tablets portrait (≤767) ── */
            @media (max-width: 767px) {
                #topbar {
                    padding: 0 10px;
                    gap: 8px;
                    height: 40px;
                }
                .logo {
                    font-size: 9px;
                }
                .sep {
                    display: none;
                }
                .tagline {
                    display: none;
                }
                .top-btn {
                    font-size: 9px;
                    padding: 4px 9px;
                }
                .kb-help-btn {
                    display: none;
                }
                .section-header {
                    padding: 6px 10px 5px;
                    gap: 6px;
                    flex-wrap: wrap;
                }
                .section-badge {
                    font-size: 9px;
                    padding: 4px 8px;
                    letter-spacing: 0.5px;
                }
                .section-title-group {
                    min-width: 0;
                    flex: 1;
                }
                .section-title {
                    font-size: 10px;
                }
                .section-subtitle {
                    font-size: 9px;
                }
                .section-controls {
                    width: 100%;
                    order: 10;
                    margin-left: 0;
                    gap: 5px;
                    flex-wrap: wrap;
                }
                .cat-tabs {
                    padding: 2px;
                    flex-wrap: wrap;
                    width: 100%;
                    order: 1;
                }
                .cat-tab {
                    font-size: 9px;
                    padding: 4px 8px;
                    gap: 4px;
                    flex: 1;
                    justify-content: center;
                }
                .cat-tab .ct-count {
                    font-size: 9px;
                    padding: 1px 5px;
                }
                .search-box {
                    flex: 1;
                    min-width: 0;
                    width: auto;
                    font-size: 10px;
                    padding: 5px 8px;
                }
                .upload-btn {
                    font-size: 9px;
                    padding: 5px 8px;
                }
                .g-card {
                    width: 115px;
                    height: 154px;
                    border-radius: 5px;
                }
                .g-card-preview .loading-text {
                    font-size: 9px;
                    letter-spacing: 2px;
                }
                .g-card-info {
                    padding: 4px 5px;
                    gap: 2px;
                    min-height: 36px;
                }
                .g-card-id {
                    font-size: 9px;
                }
                .g-tag {
                    font-size: 9px;
                    padding: 2px 5px;
                }
                .play-circle {
                    width: 26px;
                    height: 26px;
                    font-size: 11px;
                }
                .carousel-track {
                    gap: 14px;
                    padding: 10px 8px;
                }
                .carousel-btn {
                    width: 28px;
                    height: 28px;
                    font-size: 14px;
                }
                .carousel-wrapper {
                    padding: 0 4px;
                }
                .section-divider {
                    height: 2px;
                }
                .random-btn {
                    width: 28px;
                    height: 28px;
                    font-size: 13px;
                }
                .pag-btn {
                    padding: 3px 7px;
                    font-size: 9px;
                }
                .pag-info {
                    font-size: 9px;
                }
                #footer {
                    font-size: 9px;
                    padding: 4px 10px;
                }
                #footer kbd {
                    display: none;
                }
                .upload-box {
                    padding: 20px;
                    gap: 14px;
                    width: 94vw;
                    max-height: 90vh;
                    overflow-y: auto;
                    border-radius: 10px;
                }
                .upload-box h2 {
                    font-size: 11px;
                }
                .upload-drop-zone {
                    padding: 14px 10px;
                    font-size: 11px;
                }
                .upload-file-label {
                    font-size: 10px;
                }
                .upload-submit {
                    font-size: 9px;
                    padding: 9px;
                }
                .upload-hint {
                    font-size: 9px;
                }
                .kb-box {
                    padding: 18px;
                    width: 94vw;
                    border-radius: 10px;
                }
                .kb-box h2 {
                    font-size: 10px;
                }
                .kb-grid {
                    gap: 5px 10px;
                }
                .admin-box {
                    width: 94vw;
                    padding: 20px;
                    border-radius: 10px;
                }
                .card-delete-btn {
                    width: 24px;
                    height: 24px;
                    font-size: 11px;
                    top: 5px;
                    right: 5px;
                }
                /* Hide grid background on small devices */
                .bg-layer,
                .grid-bg,
                .grid-fade,
                .grid-glow {
                    display: none;
                }
            }

            /* ── Phones (≤599) ── */
            @media (max-width: 599px) {
                #topbar {
                    padding: 0 8px;
                    gap: 6px;
                    height: 38px;
                }
                .logo {
                    font-size: 9px;
                }
                .top-btn {
                    font-size: 9px;
                    padding: 4px 7px;
                    border-radius: 4px;
                }
                .top-btn-admin {
                    padding: 4px 6px;
                }
                .section-header {
                    padding: 5px 8px 4px;
                    gap: 5px;
                }
                .section-badge {
                    font-size: 9px;
                    padding: 3px 7px;
                    letter-spacing: 0.5px;
                    border-width: 1px;
                }
                .section-title {
                    font-size: 10px;
                }
                .section-subtitle {
                    font-size: 9px;
                }
                .section-count {
                    font-size: 9px;
                }
                .cat-tab {
                    font-size: 9px;
                    padding: 3px 6px;
                }
                .section-controls {
                    gap: 4px;
                }
                .search-box {
                    min-width: 0;
                    font-size: 9px;
                    padding: 4px 7px;
                }
                .upload-btn {
                    font-size: 9px;
                    padding: 4px 7px;
                }
                .g-card {
                    width: 105px;
                    height: 142px;
                    border-radius: 4px;
                }
                .g-card-info {
                    padding: 3px 4px;
                    gap: 2px;
                    min-height: 34px;
                }
                .g-card-id {
                    font-size: 9px;
                }
                .g-tag {
                    font-size: 9px;
                    padding: 2px 4px;
                }
                .play-circle {
                    width: 24px;
                    height: 24px;
                    font-size: 10px;
                }
                .carousel-track {
                    gap: 12px;
                    padding: 8px 6px;
                }
                .carousel-btn {
                    width: 24px;
                    height: 24px;
                    font-size: 12px;
                }
                .carousel-wrapper {
                    padding: 0 2px;
                }
                #footer {
                    font-size: 9px;
                    padding: 3px 8px;
                }
                .empty-msg {
                    padding: 16px 10px;
                    font-size: 10px;
                }
                .random-btn {
                    width: 26px;
                    height: 26px;
                    font-size: 12px;
                }
                /* Toast adjustments */
                #toast {
                    font-size: 10px;
                    padding: 7px 14px;
                    max-width: 92vw;
                }
            }

            /* ── Small phones (≤479) ── */
            @media (max-width: 479px) {
                #topbar {
                    padding: 0 6px;
                    gap: 5px;
                    height: 36px;
                }
                .logo {
                    font-size: 9px;
                }
                .top-btn {
                    font-size: 9px;
                    padding: 3px 6px;
                }
                .section-header {
                    padding: 4px 6px 3px;
                    gap: 4px;
                }
                .section-badge {
                    font-size: 9px;
                    padding: 3px 5px;
                }
                .section-title {
                    font-size: 9px;
                }
                .section-subtitle {
                    display: none;
                }
                .cat-tab {
                    font-size: 9px;
                    padding: 3px 5px;
                }
                .cat-tab .ct-count {
                    font-size: 9px;
                    padding: 0 4px;
                }
                .search-box {
                    font-size: 9px;
                    padding: 4px 6px;
                }
                .upload-btn {
                    font-size: 9px;
                    padding: 3px 6px;
                    gap: 3px;
                }
                .pag-btn {
                    padding: 2px 5px;
                    font-size: 9px;
                }
                .pag-info {
                    font-size: 9px;
                }
                .g-card {
                    width: 95px;
                    height: 128px;
                    border-radius: 4px;
                }
                .g-card-info {
                    padding: 3px 4px;
                    gap: 2px;
                    min-height: 30px;
                }
                .g-card-id {
                    font-size: 9px;
                }
                .g-card-tags {
                    gap: 2px;
                }
                .g-tag {
                    font-size: 9px;
                    padding: 1px 3px;
                    border-radius: 2px;
                }
                .play-circle {
                    width: 22px;
                    height: 22px;
                    font-size: 9px;
                }
                .carousel-btn {
                    width: 22px;
                    height: 22px;
                    font-size: 11px;
                }
                .carousel-track {
                    gap: 10px;
                    padding: 6px 4px;
                }
                .carousel-wrapper {
                    padding: 0;
                }
                #footer {
                    font-size: 9px;
                    padding: 2px 6px;
                }
                .random-btn {
                    width: 24px;
                    height: 24px;
                    font-size: 11px;
                    border-radius: 5px;
                }
                .upload-box {
                    padding: 16px;
                    gap: 12px;
                    border-radius: 8px;
                }
                .upload-box h2 {
                    font-size: 10px;
                }
                .upload-drop-zone {
                    padding: 12px 8px;
                    font-size: 10px;
                }
                .upload-drop-zone span[style] {
                    font-size: 20px !important;
                }
                .upload-file-label {
                    font-size: 9px;
                }
                .upload-file-pick input[type="file"] {
                    font-size: 9px;
                }
                .upload-file-pick input[type="file"]::file-selector-button {
                    font-size: 9px;
                    padding: 3px 6px;
                }
                .upload-submit {
                    font-size: 9px;
                    padding: 8px;
                }
                .upload-cancel {
                    font-size: 9px;
                    padding: 4px;
                }
                .upload-hint {
                    font-size: 9px;
                }
                .upload-status {
                    font-size: 9px;
                }
                .admin-box {
                    padding: 16px;
                    width: 94vw;
                    border-radius: 8px;
                }
                .admin-box h2 {
                    font-size: 10px;
                }
                .admin-input {
                    font-size: 10px;
                    padding: 7px 8px;
                }
                .admin-submit {
                    font-size: 9px;
                    padding: 8px;
                }
                .card-delete-btn {
                    width: 22px;
                    height: 22px;
                    font-size: 10px;
                    top: 3px;
                    right: 3px;
                    border-width: 1px;
                }
                #toast {
                    font-size: 9px;
                    padding: 5px 10px;
                    border-radius: 5px;
                }
            }

            /* ── Tiny phones (≤359) — iPhone SE 1st gen, Galaxy Fold closed ── */
            @media (max-width: 359px) {
                #topbar {
                    padding: 0 4px;
                    gap: 4px;
                    height: 34px;
                }
                .logo {
                    font-size: 9px;
                }
                .top-btn {
                    font-size: 9px;
                    padding: 2px 5px;
                }
                .section-header {
                    padding: 3px 4px 2px;
                    gap: 3px;
                }
                .section-badge {
                    font-size: 9px;
                    padding: 2px 4px;
                    letter-spacing: 0;
                }
                .section-title {
                    font-size: 9px;
                }
                .cat-tab {
                    font-size: 9px;
                    padding: 2px 4px;
                }
                .g-card {
                    width: 85px;
                    height: 115px;
                    border-radius: 3px;
                }
                .g-card-info {
                    padding: 2px 3px;
                    min-height: 26px;
                    gap: 2px;
                }
                .g-card-id {
                    font-size: 9px;
                }
                .g-tag {
                    font-size: 9px;
                    padding: 1px 3px;
                }
                .g-card-tags {
                    display: none;
                }
                .play-circle {
                    width: 20px;
                    height: 20px;
                    font-size: 9px;
                }
                .carousel-btn {
                    width: 20px;
                    height: 20px;
                    font-size: 10px;
                }
                .carousel-track {
                    gap: 8px;
                    padding: 5px 2px;
                }
                .random-btn {
                    width: 22px;
                    height: 22px;
                    font-size: 10px;
                }
                .pag-row {
                    display: none;
                }
                .upload-box {
                    padding: 14px;
                    gap: 10px;
                    border-radius: 6px;
                }
                .kb-box {
                    padding: 14px;
                    border-radius: 6px;
                }
                .admin-box {
                    padding: 14px;
                    border-radius: 6px;
                }
                #footer {
                    padding: 2px 4px;
                }
            }

            /* ── Landscape orientation helpers ── */
            @media (max-height: 500px) and (orientation: landscape) {
                #topbar {
                    height: 34px;
                }
                .section-header {
                    padding: 3px 10px 2px;
                }
                .g-card {
                    height: auto;
                    min-height: 120px;
                    width: 120px;
                }
                .g-card-info {
                    min-height: auto;
                    padding: 5px 6px;
                }
                .carousel-track {
                    padding: 8px 8px;
                    gap: 12px;
                }
                .section-divider {
                    height: 2px;
                }
                #footer {
                    padding: 2px 8px;
                    font-size: 9px;
                }
                .upload-box,
                .kb-box,
                .admin-box {
                    max-height: 85vh;
                    overflow-y: auto;
                }
                .section-subtitle {
                    display: none;
                }
            }

            /* ── High-DPI / Retina — ensure crisp grid lines ── */
            @media (-webkit-min-device-pixel-ratio: 2),
                (min-resolution: 192dpi) {
                .g-card {
                    border-width: 0.5px;
                }
                .section-divider {
                    height: 2px;
                }
            }

            /* ═══ CARD ENTRANCE ANIMATION ═══ */
            @keyframes cardFadeIn {
                from {
                    opacity: 0;
                    transform: translateY(18px) scale(0.96);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }
            .g-card.card-enter {
                animation: cardFadeIn 0.25s ease both;
            }

            /* ═══ RANDOM BUTTON ═══ */
            .random-btn {
                font-size: 16px;
                width: 34px;
                height: 34px;
                border-radius: 8px;
                border: 1px solid var(--border);
                background: transparent;
                color: var(--text-dim);
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s;
                flex-shrink: 0;
                position: relative;
            }
            .random-btn:hover {
                border-color: var(--accent);
                color: var(--text-bright);
                background: rgba(88, 166, 255, 0.08);
                transform: rotate(15deg) scale(1.1);
            }
            .random-btn:active {
                transform: rotate(360deg) scale(0.95);
                transition: transform 0.4s;
            }
            .random-btn .random-tooltip {
                display: none;
                position: absolute;
                bottom: calc(100% + 6px);
                left: 50%;
                transform: translateX(-50%);
                font-family: var(--code);
                font-size: 9px;
                white-space: nowrap;
                background: var(--panel2);
                color: var(--text);
                border: 1px solid var(--border);
                border-radius: 4px;
                padding: 3px 8px;
                pointer-events: none;
            }
            .random-btn:hover .random-tooltip {
                display: block;
            }

            /* ═══ KEYBOARD HELP ═══ */
            .kb-help-btn {
                font-family: var(--code);
                font-size: 10px;
                padding: 6px 10px;
                border-radius: 6px;
                border: 1px solid var(--border);
                background: transparent;
                color: var(--text-dim);
                cursor: pointer;
                transition: all 0.15s;
                white-space: nowrap;
            }
            .kb-help-btn:hover {
                border-color: var(--accent);
                color: var(--text-bright);
                background: rgba(88, 166, 255, 0.06);
            }
            #kb-panel {
                display: none;
                position: fixed;
                inset: 0;
                z-index: 900;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(4px);
                align-items: center;
                justify-content: center;
            }
            #kb-panel.show {
                display: flex;
            }
            .kb-box {
                background: var(--panel);
                border: 1px solid var(--border);
                border-radius: 14px;
                padding: 28px 32px;
                width: 420px;
                max-width: 90vw;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            }
            .kb-box h2 {
                font-family: var(--pixel);
                font-size: 12px;
                color: var(--accent);
                text-align: center;
                margin-bottom: 20px;
                letter-spacing: 1px;
            }
            .kb-grid {
                display: grid;
                grid-template-columns: auto 1fr;
                gap: 8px 16px;
                align-items: center;
            }
            .kb-key {
                font-family: var(--code);
                font-size: 10px;
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 4px;
                padding: 3px 8px;
                color: var(--text-bright);
                text-align: center;
                white-space: nowrap;
            }
            .kb-desc {
                font-family: var(--code);
                font-size: 10px;
                color: var(--text-dim);
            }
            .kb-section-title {
                grid-column: 1 / -1;
                font-family: var(--code);
                font-size: 9px;
                color: var(--purple);
                text-transform: uppercase;
                letter-spacing: 1px;
                margin-top: 10px;
                padding-bottom: 4px;
                border-bottom: 1px solid rgba(188, 140, 255, 0.15);
            }
            .kb-section-title:first-child {
                margin-top: 0;
            }
            .kb-close {
                display: block;
                margin: 20px auto 0;
                font-family: var(--code);
                font-size: 10px;
                color: var(--text-dim);
                background: none;
                border: none;
                cursor: pointer;
                padding: 6px 16px;
            }
            .kb-close:hover {
                color: var(--text-bright);
            }

            /* ═══ UPLOAD MODAL (AGI-3) ═══ */
            #upload-modal {
                display: none;
                position: fixed;
                inset: 0;
                z-index: 1000;
                background: rgba(0, 0, 0, 0.7);
                backdrop-filter: blur(6px);
                align-items: center;
                justify-content: center;
            }
            #upload-modal.show {
                display: flex;
            }
            .upload-box {
                background: var(--panel);
                border: 1px solid var(--border);
                border-radius: 14px;
                padding: 32px;
                width: 480px;
                max-width: 92vw;
                display: flex;
                flex-direction: column;
                gap: 18px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            }
            .upload-box h2 {
                font-family: var(--pixel);
                font-size: 12px;
                color: var(--green);
                text-align: center;
                letter-spacing: 1px;
            }
            .upload-file-row {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }
            .upload-file-label {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                display: flex;
                align-items: center;
                gap: 6px;
            }
            .upload-file-label .ufl-req {
                color: var(--red);
                font-size: 9px;
            }
            .upload-file-pick {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .upload-file-pick label {
                font-family: var(--code);
                font-size: 10px;
                padding: 8px 16px;
                border: 1px dashed var(--border);
                border-radius: 6px;
                color: var(--text-dim);
                cursor: pointer;
                transition: all 0.15s;
                white-space: nowrap;
                flex-shrink: 0;
            }
            .upload-file-pick label:hover {
                border-color: var(--green);
                color: var(--text-bright);
                background: rgba(63, 185, 80, 0.06);
            }
            .upload-file-pick label.has-file {
                border-color: var(--green);
                border-style: solid;
                color: var(--green);
                background: rgba(63, 185, 80, 0.08);
            }
            .upload-file-pick input[type="file"] {
                font-family: var(--code);
                font-size: 10px;
                color: var(--text-dim);
                cursor: pointer;
                width: 100%;
            }
            .upload-file-pick input[type="file"]::file-selector-button {
                font-family: var(--code);
                font-size: 10px;
                padding: 5px 12px;
                margin-right: 8px;
                background: var(--green-dim);
                color: #fff;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
            .upload-file-pick input[type="file"]::file-selector-button:hover {
                background: var(--green);
            }
            .upload-drop-zone {
                border: 2px dashed var(--border);
                border-radius: 8px;
                padding: 20px 16px;
                text-align: center;
                color: var(--text-dim);
                font-size: 12px;
                line-height: 1.6;
                margin-bottom: 14px;
                transition: all 0.2s;
                cursor: pointer;
            }
            .upload-drop-zone:hover,
            .upload-drop-zone.dragover {
                border-color: var(--green);
                background: rgba(63, 185, 80, 0.04);
                color: var(--text-bright);
            }
            .upload-drop-files {
                margin-top: 6px;
                font-size: 11px;
                color: var(--green);
                min-height: 16px;
            }
            .upload-file-name {
                font-family: var(--code);
                font-size: 10px;
                color: #444;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                min-width: 0;
            }
            .upload-file-name.selected {
                color: var(--green);
            }
            .upload-submit {
                width: 100%;
                padding: 11px;
                font-family: var(--pixel);
                font-size: 10px;
                letter-spacing: 1px;
                color: #fff;
                background: linear-gradient(
                    135deg,
                    var(--green),
                    var(--green-dim)
                );
                border: none;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.2s;
            }
            .upload-submit:hover:not(:disabled) {
                box-shadow: 0 4px 20px rgba(63, 185, 80, 0.3);
                transform: translateY(-1px);
            }
            .upload-submit:disabled {
                opacity: 0.35;
                cursor: default;
                transform: none;
                box-shadow: none;
            }
            .upload-status {
                font-family: var(--code);
                font-size: 11px;
                text-align: center;
                min-height: 16px;
            }
            .upload-status.err {
                color: var(--red);
            }
            .upload-status.ok {
                color: var(--green);
            }
            .upload-status.info {
                color: var(--accent);
            }
            .upload-cancel {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                background: none;
                border: none;
                cursor: pointer;
                text-align: center;
                padding: 4px;
            }
            .upload-cancel:hover {
                color: var(--text-bright);
            }
            .upload-hint {
                font-family: var(--code);
                font-size: 9px;
                color: #444;
                text-align: center;
                line-height: 1.6;
            }
        </style>
    </head>
    <body>
        <!-- ═══ BACKGROUND LAYER ═══ -->
        <div class="bg-layer"></div>

        <!-- ═══ ANIMATED GRID BACKGROUND (arcprize.org style) ═══ -->
        <div class="grid-bg">
            <div class="grid-bg-lines"></div>
        </div>
        <div class="grid-fade"></div>
        <div class="grid-glow"></div>

        <div id="app">
            <!-- ═══ TOP BAR ═══ -->
            <div id="topbar">
                <a href="/" class="logo">Ethara AI × ARC</a>
                <div class="sep"></div>
                <div class="tagline">Abstraction &amp; Reasoning Corpus</div>
                <div class="spacer"></div>
                <button
                    class="kb-help-btn"
                    id="btn-kb-help"
                    title="Keyboard Shortcuts"
                >
                    ⌨ Shortcuts
                </button>
                <button
                    class="top-btn top-btn-admin"
                    id="btn-admin"
                    title="Admin Panel"
                >
                    🔒 Admin
                </button>
                <button
                    class="top-btn top-btn-logout"
                    id="btn-logout"
                    style="display: none"
                >
                    Logout
                </button>
            </div>

            <!-- ═══ ADMIN LOGIN MODAL ═══ -->
            <div id="admin-modal">
                <div class="admin-box">
                    <h2>🔒 ADMIN LOGIN</h2>
                    <input
                        type="text"
                        class="admin-input"
                        id="admin-user"
                        placeholder="Username"
                        autocomplete="off"
                    />
                    <input
                        type="password"
                        class="admin-input"
                        id="admin-pass"
                        placeholder="Password"
                    />
                    <button class="admin-submit" id="admin-login-btn">
                        AUTHENTICATE
                    </button>
                    <div class="admin-status" id="admin-status"></div>
                    <button class="admin-cancel" id="admin-cancel">
                        Cancel
                    </button>
                </div>
            </div>

            <!-- ═══ KEYBOARD HELP PANEL ═══ -->
            <div id="kb-panel">
                <div class="kb-box">
                    <h2>⌨ KEYBOARD SHORTCUTS</h2>
                    <div class="kb-grid">
                        <div class="kb-section-title">Navigation</div>
                        <span class="kb-key">← →</span>
                        <span class="kb-desc"
                            >Scroll carousel left / right</span
                        >
                        <span class="kb-key">[ ]</span>
                        <span class="kb-desc"
                            >Previous / Next page (AGI-2)</span
                        >
                        <span class="kb-key">1 2 3</span>
                        <span class="kb-desc"
                            >Switch AGI-2 tab (My Tasks / Training / Eval)</span
                        >
                        <div class="kb-section-title">Actions</div>
                        <span class="kb-key">R</span>
                        <span class="kb-desc">Open random task or game</span>
                        <span class="kb-key">/</span>
                        <span class="kb-desc">Focus search box</span>
                        <div class="kb-section-title">Interface</div>
                        <span class="kb-key">?</span>
                        <span class="kb-desc">Toggle this help panel</span>
                        <span class="kb-key">Esc</span>
                        <span class="kb-desc">Close modal / panel</span>
                    </div>
                    <button class="kb-close" id="kb-close">
                        Press <strong>?</strong> or <strong>Esc</strong> to
                        close
                    </button>
                </div>
            </div>

            <!-- ═══ AGI-3 UPLOAD MODAL ═══ -->
            <div id="upload-modal">
                <div class="upload-box">
                    <h2>↑ UPLOAD AGI-3 GAME</h2>

                    <div class="upload-drop-zone" id="upload-drop-zone">
                        <span
                            style="
                                font-size: 28px;
                                display: block;
                                margin-bottom: 6px;
                            "
                            >📁</span
                        >
                        Drag &amp; drop <strong>.py</strong> +
                        <strong>.json</strong> here
                        <div class="upload-drop-files" id="upload-drop-status">
                            or choose files below
                        </div>
                    </div>

                    <div class="upload-file-row">
                        <div class="upload-file-label">
                            Game Python file
                            <span class="ufl-req">*required</span>
                        </div>
                        <div class="upload-file-pick">
                            <input type="file" id="upload-py" accept=".py" />
                        </div>
                    </div>

                    <div class="upload-file-row">
                        <div class="upload-file-label">
                            Metadata JSON <span class="ufl-req">*required</span>
                        </div>
                        <div class="upload-file-pick">
                            <input
                                type="file"
                                id="upload-json"
                                accept=".json"
                            />
                        </div>
                    </div>

                    <button
                        class="upload-submit"
                        id="upload-submit-btn"
                        disabled
                    >
                        UPLOAD GAME
                    </button>
                    <div class="upload-status" id="upload-status"></div>
                    <div class="upload-hint">
                        Select both files, then click Upload.<br />
                        The metadata.json must contain a
                        <strong>game_id</strong> field.
                    </div>
                    <button class="upload-cancel" id="upload-cancel">
                        Cancel
                    </button>
                </div>
            </div>

            <!-- ═══ TOAST ═══ -->
            <div id="toast"></div>

            <!-- ═══ CONTENT ═══ -->
            <div id="content">
                <!-- ── TOP: AGI-2 Puzzles ── -->
                <div class="section-panel" id="panel-agi2">
                    <div class="section-header">
                        <span class="section-badge badge-purple">AGI-2</span>
                        <div class="section-title-group">
                            <span class="section-title">ARC Puzzles</span>
                            <span class="section-subtitle">
                                <span id="agi2-count"></span>
                                <span style="color: #333">·</span>
                                Classic pattern recognition
                            </span>
                        </div>
                        <div class="cat-tabs" id="agi2-tabs">
                            <button class="cat-tab active" data-cat="my_tasks">
                                Arc Arena
                                <span class="ct-count" id="ct-my_tasks">0</span>
                            </button>
                            <button class="cat-tab" data-cat="training">
                                Training
                                <span class="ct-count" id="ct-training">0</span>
                            </button>
                            <button class="cat-tab" data-cat="evaluation">
                                Evaluation
                                <span class="ct-count" id="ct-evaluation"
                                    >0</span
                                >
                            </button>
                        </div>
                        <div class="section-controls">
                            <label class="upload-btn" for="agi2-upload">
                                ↑ Upload .json
                                <input
                                    type="file"
                                    id="agi2-upload"
                                    accept=".json"
                                />
                            </label>
                            <div
                                class="pag-row"
                                id="agi2-pag"
                                style="display: none"
                            >
                                <button class="pag-btn" id="agi2-prev">
                                    ←
                                </button>
                                <span
                                    class="pag-info"
                                    id="agi2-pag-info"
                                ></span>
                                <button class="pag-btn" id="agi2-next">
                                    →
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-wrapper">
                        <button
                            class="carousel-btn"
                            id="agi2-left"
                            title="Scroll left"
                        >
                            ‹
                        </button>
                        <div class="carousel-track" id="agi2-track"></div>
                        <button
                            class="carousel-btn"
                            id="agi2-right"
                            title="Scroll right"
                        >
                            ›
                        </button>
                    </div>
                </div>

                <!-- ── DIVIDER ── -->
                <div class="section-divider"></div>

                <!-- ── BOTTOM: AGI-3 Games ── -->
                <div class="section-panel" id="panel-agi3">
                    <div class="section-header">
                        <span class="section-badge badge-green">AGI-3</span>
                        <div class="section-title-group">
                            <span class="section-title">Interactive Games</span>
                            <span class="section-subtitle">
                                <span id="agi3-count"></span>
                                <span style="color: #333">·</span>
                                Real-time game environments
                            </span>
                        </div>

                        <div class="section-controls">
                            <button class="upload-btn" id="agi3-upload-btn">
                                ↑ Upload game
                            </button>
                        </div>
                    </div>
                    <div class="carousel-wrapper">
                        <button
                            class="carousel-btn"
                            id="agi3-left"
                            title="Scroll left"
                        >
                            ‹
                        </button>
                        <div class="carousel-track" id="agi3-track"></div>
                        <button
                            class="carousel-btn"
                            id="agi3-right"
                            title="Scroll right"
                        >
                            ›
                        </button>
                    </div>
                </div>
            </div>

            <!-- ═══ FOOTER ═══ -->
            <div id="footer">
                Powered by
                <a href="https://ethara.ai" target="_blank">Ethara AI</a> ·
                <a
                    href="https://github.com/Raj602-stack/Arc-Agi3"
                    target="_blank"
                    >GitHub</a
                >
                · Press
                <kbd
                    style="
                        font-family: var(--code);
                        font-size: 9px;
                        background: var(--bg);
                        border: 1px solid var(--border);
                        border-radius: 3px;
                        padding: 1px 5px;
                        color: var(--text);
                    "
                    >?</kbd
                >
                for shortcuts
            </div>
        </div>

        <script>
            // ══════════════════════════════════════════════════════════════
            //  Unified Landing Page — AGI-2 (top) + AGI-3 (bottom)
            //  Horizontal carousel layout, direct game launch on click
            // ══════════════════════════════════════════════════════════════

            // ── State ────────────────────────────────────────────────────
            var agi2Index = null;
            var agi2Category = "my_tasks";
            var agi2Search = "";
            var agi2Page = 0;
            var AGI2_PER_PAGE = 40;

            var agi3Games = [];
            var agi3Search = "";

            // ── DOM refs ─────────────────────────────────────────────────
            var agi2Track = document.getElementById("agi2-track");
            var agi2Pag = document.getElementById("agi2-pag");
            var agi3Track = document.getElementById("agi3-track");

            // ══════════════════════════════════════════════════════════════
            //  CAROUSEL HELPERS
            // ══════════════════════════════════════════════════════════════

            function setupCarousel(trackId, leftBtnId, rightBtnId) {
                var track = document.getElementById(trackId);
                var leftBtn = document.getElementById(leftBtnId);
                var rightBtn = document.getElementById(rightBtnId);

                function updateButtons() {
                    var maxScroll = track.scrollWidth - track.clientWidth;
                    var overflows = maxScroll > 4;

                    if (overflows) {
                        track.classList.add("has-overflow");
                    } else {
                        track.classList.remove("has-overflow");
                    }

                    leftBtn.disabled = track.scrollLeft <= 2;
                    rightBtn.disabled =
                        !overflows || track.scrollLeft >= maxScroll - 2;

                    // Hide arrows entirely if no overflow
                    leftBtn.style.visibility = overflows ? "" : "hidden";
                    rightBtn.style.visibility = overflows ? "" : "hidden";
                }

                function scrollBy(dir) {
                    var amount = track.clientWidth * 0.7;
                    track.scrollBy({
                        left: dir * amount,
                        behavior: "smooth",
                    });
                }

                leftBtn.addEventListener("click", function () {
                    scrollBy(-1);
                });
                rightBtn.addEventListener("click", function () {
                    scrollBy(1);
                });

                track.addEventListener("scroll", updateButtons);
                window.addEventListener("resize", updateButtons);

                // Initial state
                setTimeout(updateButtons, 150);

                return { track: track, updateButtons: updateButtons };
            }

            var agi2Carousel = setupCarousel(
                "agi2-track",
                "agi2-left",
                "agi2-right",
            );
            var agi3Carousel = setupCarousel(
                "agi3-track",
                "agi3-left",
                "agi3-right",
            );

            // ══════════════════════════════════════════════════════════════
            //  AGI-3 — Fetch games and render cards
            // ══════════════════════════════════════════════════════════════

            function fetchAgi3Games() {
                fetch("/api/games")
                    .then(function (r) {
                        return r.json();
                    })
                    .then(function (data) {
                        agi3Games = data.games || [];
                        document.getElementById("agi3-count").textContent =
                            agi3Games.length +
                            " game" +
                            (agi3Games.length !== 1 ? "s" : "");
                        renderAgi3();
                    })
                    .catch(function (err) {
                        agi3Track.innerHTML =
                            '<div class="empty-msg">Could not load games.<br>' +
                            err +
                            "</div>";
                    });
            }

            function renderAgi3() {
                var q = agi3Search.toLowerCase();
                var filtered = agi3Games.filter(function (g) {
                    return (
                        !q ||
                        g.game_id.toLowerCase().indexOf(q) !== -1 ||
                        (g.tags || []).join(" ").toLowerCase().indexOf(q) !== -1
                    );
                });

                agi3Track.innerHTML = "";

                if (filtered.length === 0) {
                    agi3Track.innerHTML = q
                        ? '<div class="empty-msg">No games match \u201c<code>' +
                          agi3Search +
                          "</code>\u201d</div>"
                        : '<div class="empty-msg">No games found.<br>Drop a game into <code>environment_files/</code> or use Upload.</div>';
                    agi3Carousel.updateButtons();
                    return;
                }

                filtered.forEach(function (g, _idx) {
                    var card = document.createElement("div");
                    card.className = "g-card agi3-card card-enter";
                    card.style.animationDelay = _idx * 0.04 + "s";

                    // Admin delete button
                    var delBtn = document.createElement("button");
                    delBtn.className = "card-delete-btn";
                    delBtn.textContent = "✕";
                    delBtn.title = "Delete " + g.game_id;
                    (function (gid, el) {
                        delBtn.addEventListener("click", function (e) {
                            e.stopPropagation();
                            deleteAgi3Game(gid, el);
                        });
                    })(g.game_id, card);
                    card.appendChild(delBtn);

                    var previewDiv = document.createElement("div");
                    previewDiv.className = "g-card-preview";
                    previewDiv.innerHTML =
                        '<div class="loading-text">LOADING\u2026</div>';

                    var overlay = document.createElement("div");
                    overlay.className = "card-overlay";
                    overlay.innerHTML =
                        '<div class="play-circle agi3-play">\u25B6</div>';
                    previewDiv.appendChild(overlay);

                    var img = new Image();
                    img.onload = function () {
                        var lt = previewDiv.querySelector(".loading-text");
                        if (lt) lt.remove();
                        previewDiv.insertBefore(img, previewDiv.firstChild);
                    };
                    img.onerror = function () {
                        var lt = previewDiv.querySelector(".loading-text");
                        if (lt) lt.textContent = "NO PREVIEW";
                    };
                    img.src =
                        "/api/games/" +
                        encodeURIComponent(g.game_id) +
                        "/preview";

                    var info = document.createElement("div");
                    info.className = "g-card-info";

                    var idEl = document.createElement("div");
                    idEl.className = "g-card-id";
                    idEl.textContent = g.game_id;

                    info.appendChild(idEl);

                    card.appendChild(previewDiv);
                    card.appendChild(info);

                    // Click → directly open and play the game
                    card.addEventListener("click", function () {
                        window.location.href =
                            "/arc-agi-3/game/" + encodeURIComponent(g.game_id);
                    });

                    agi3Track.appendChild(card);
                });

                setTimeout(function () {
                    agi3Carousel.updateButtons();
                }, 80);
            }

            // ── AGI-3 Search ──
            var _agi3Search = document.getElementById("agi3-search");
            if (_agi3Search) {
                _agi3Search.addEventListener("input", function () {
                    agi3Search = this.value.trim();
                    renderAgi3();
                });
            }

            // ── AGI-3 Upload Modal ──
            var uploadModal = document.getElementById("upload-modal");
            var uploadPyInput = document.getElementById("upload-py");
            var uploadJsonInput = document.getElementById("upload-json");
            var uploadSubmitBtn = document.getElementById("upload-submit-btn");
            var uploadStatusEl = document.getElementById("upload-status");
            var uploadDropZone = document.getElementById("upload-drop-zone");
            var uploadDropStatus =
                document.getElementById("upload-drop-status");
            // Store file references in JS — never rely on input.files at submit time
            var _storedPyFile = null;
            var _storedJsonFile = null;

            function _updateUploadUI() {
                uploadSubmitBtn.disabled = !(_storedPyFile && _storedJsonFile);
                var parts = [];
                if (_storedPyFile)
                    parts.push(
                        "✓ " +
                            _storedPyFile.name +
                            " (" +
                            (_storedPyFile.size / 1024).toFixed(1) +
                            " KB)",
                    );
                if (_storedJsonFile)
                    parts.push(
                        "✓ " +
                            _storedJsonFile.name +
                            " (" +
                            (_storedJsonFile.size / 1024).toFixed(1) +
                            " KB)",
                    );
                uploadDropStatus.innerHTML =
                    parts.length > 0
                        ? parts.join("<br>")
                        : "or choose files below";
            }

            function _handleUploadFile(file) {
                if (!file) return;
                if (file.name.endsWith(".py")) {
                    _storedPyFile = file;
                    console.log(
                        "[Upload] Stored .py:",
                        file.name,
                        file.size,
                        "bytes",
                    );
                } else if (file.name.endsWith(".json")) {
                    _storedJsonFile = file;
                    console.log(
                        "[Upload] Stored .json:",
                        file.name,
                        file.size,
                        "bytes",
                    );
                }
                _updateUploadUI();
            }

            function openUploadModal() {
                _storedPyFile = null;
                _storedJsonFile = null;
                uploadPyInput.value = "";
                uploadJsonInput.value = "";
                uploadSubmitBtn.disabled = true;
                uploadSubmitBtn.textContent = "UPLOAD GAME";
                uploadStatusEl.textContent = "";
                uploadStatusEl.className = "upload-status";
                _updateUploadUI();
                uploadModal.classList.add("show");
            }

            function closeUploadModal() {
                uploadModal.classList.remove("show");
            }

            document
                .getElementById("agi3-upload-btn")
                .addEventListener("click", openUploadModal);
            document
                .getElementById("upload-cancel")
                .addEventListener("click", closeUploadModal);
            uploadModal.addEventListener("click", function (e) {
                if (e.target === uploadModal) closeUploadModal();
            });

            // Drag-and-drop support
            uploadDropZone.addEventListener("dragover", function (e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.add("dragover");
            });
            uploadDropZone.addEventListener("dragleave", function (e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.remove("dragover");
            });
            uploadDropZone.addEventListener("drop", function (e) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.remove("dragover");
                for (var i = 0; i < e.dataTransfer.files.length; i++) {
                    _handleUploadFile(e.dataTransfer.files[i]);
                }
            });
            uploadDropZone.addEventListener("click", function () {
                var inp = document.createElement("input");
                inp.type = "file";
                inp.multiple = true;
                inp.accept = ".py,.json";
                inp.onchange = function () {
                    for (var i = 0; i < inp.files.length; i++) {
                        _handleUploadFile(inp.files[i]);
                    }
                };
                inp.click();
            });

            // File inputs — store in variable immediately on selection
            uploadPyInput.addEventListener("change", function () {
                if (this.files && this.files[0]) {
                    _storedPyFile = this.files[0];
                    console.log("[Upload] .py via input:", _storedPyFile.name);
                }
                _updateUploadUI();
            });
            uploadJsonInput.addEventListener("change", function () {
                if (this.files && this.files[0]) {
                    _storedJsonFile = this.files[0];
                    console.log(
                        "[Upload] .json via input:",
                        _storedJsonFile.name,
                    );
                }
                _updateUploadUI();
            });

            // Upload submit — uses stored file refs + XMLHttpRequest for reliability
            uploadSubmitBtn.addEventListener("click", function () {
                // Use stored files; fall back to input.files if somehow stored is null
                var pyFile = _storedPyFile;
                var jsonFile = _storedJsonFile;
                if (!pyFile && uploadPyInput.files && uploadPyInput.files[0]) {
                    pyFile = uploadPyInput.files[0];
                }
                if (
                    !jsonFile &&
                    uploadJsonInput.files &&
                    uploadJsonInput.files[0]
                ) {
                    jsonFile = uploadJsonInput.files[0];
                }

                console.log("[Upload] === SUBMIT ===");
                console.log(
                    "[Upload] pyFile:",
                    pyFile
                        ? pyFile.name + " (" + pyFile.size + " bytes)"
                        : "MISSING",
                );
                console.log(
                    "[Upload] jsonFile:",
                    jsonFile
                        ? jsonFile.name + " (" + jsonFile.size + " bytes)"
                        : "MISSING",
                );

                if (!pyFile || !jsonFile) {
                    uploadStatusEl.textContent =
                        "✗ Select both a .py game file and a .json metadata file";
                    uploadStatusEl.className = "upload-status err";
                    return;
                }
                if (pyFile.size === 0) {
                    uploadStatusEl.textContent =
                        "✗ Python file is empty (0 bytes)";
                    uploadStatusEl.className = "upload-status err";
                    return;
                }
                if (jsonFile.size === 0) {
                    uploadStatusEl.textContent =
                        "✗ JSON file is empty (0 bytes)";
                    uploadStatusEl.className = "upload-status err";
                    return;
                }

                uploadSubmitBtn.disabled = true;
                uploadSubmitBtn.textContent = "UPLOADING…";
                uploadStatusEl.textContent = "Uploading files…";
                uploadStatusEl.className = "upload-status info";

                var form = new FormData();
                form.append("game_py", pyFile, pyFile.name);
                form.append("metadata", jsonFile, jsonFile.name);

                // Debug: log FormData keys
                var fdKeys = [];
                form.forEach(function (val, key) {
                    fdKeys.push(key + "=" + (val.name || val));
                });
                console.log("[Upload] FormData keys:", fdKeys.join(", "));

                // Use XMLHttpRequest — more reliable than fetch for multipart uploads
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/upload", true);

                xhr.onload = function () {
                    console.log(
                        "[Upload] Response:",
                        xhr.status,
                        xhr.responseText.substring(0, 500),
                    );
                    var data;
                    try {
                        data = JSON.parse(xhr.responseText);
                    } catch (e) {
                        console.error(
                            "[Upload] Failed to parse response as JSON",
                        );
                        uploadStatusEl.textContent =
                            "✗ Invalid server response";
                        uploadStatusEl.className = "upload-status err";
                        uploadSubmitBtn.disabled = false;
                        uploadSubmitBtn.textContent = "UPLOAD GAME";
                        return;
                    }

                    if (xhr.status >= 200 && xhr.status < 300) {
                        uploadStatusEl.textContent =
                            "✓ Uploaded: " + (data.game_id || "OK");
                        uploadStatusEl.className = "upload-status ok";
                        uploadSubmitBtn.textContent = "✓ DONE";
                        showToast(
                            "✓ Game uploaded: " + (data.game_id || "OK"),
                            "ok",
                            3000,
                        );
                        fetchAgi3Games();
                        setTimeout(closeUploadModal, 1200);
                    } else {
                        var errMsg =
                            data.error ||
                            "Upload failed (HTTP " + xhr.status + ")";
                        console.error("[Upload] Server error:", errMsg);
                        uploadStatusEl.textContent = "✗ " + errMsg;
                        uploadStatusEl.className = "upload-status err";
                        uploadSubmitBtn.disabled = false;
                        uploadSubmitBtn.textContent = "UPLOAD GAME";
                        showToast("✗ " + errMsg, "err", 4000);
                    }
                };

                xhr.onerror = function () {
                    console.error("[Upload] XHR network error");
                    uploadStatusEl.textContent =
                        "✗ Network error — is the server running?";
                    uploadStatusEl.className = "upload-status err";
                    uploadSubmitBtn.disabled = false;
                    uploadSubmitBtn.textContent = "UPLOAD GAME";
                    showToast("✗ Network error during upload", "err", 4000);
                };

                console.log("[Upload] Sending XHR POST to /api/upload ...");
                xhr.send(form);
            });

            // ══════════════════════════════════════════════════════════════
            //  AGI-2 — Fetch task index and render cards
            // ══════════════════════════════════════════════════════════════

            function fetchAgi2Index() {
                fetch("/api/agi2/tasks")
                    .then(function (r) {
                        return r.json();
                    })
                    .then(function (data) {
                        agi2Index = data;
                        updateAgi2TabCounts();
                        renderAgi2();
                    })
                    .catch(function (err) {
                        agi2Track.innerHTML =
                            '<div class="empty-msg">Could not load task index.<br>' +
                            err +
                            "</div>";
                    });
            }

            function updateAgi2TabCounts() {
                if (!agi2Index) return;
                var cats = ["my_tasks", "training", "evaluation"];
                var total = 0;
                cats.forEach(function (c) {
                    var arr = agi2Index[c] || [];
                    total += arr.length;
                    var el = document.getElementById("ct-" + c);
                    if (el) el.textContent = arr.length;
                });
                document.getElementById("agi2-count").textContent =
                    total + " puzzles";
            }

            function getAgi2Files() {
                if (!agi2Index) return [];
                var files = agi2Index[agi2Category] || [];
                if (agi2Search) {
                    var q = agi2Search.toLowerCase();
                    files = files.filter(function (f) {
                        return f.toLowerCase().indexOf(q) !== -1;
                    });
                }
                return files;
            }

            function renderAgi2() {
                agi2Track.innerHTML = "";

                var files = getAgi2Files();

                // Update count display for filtered
                if (agi2Search) {
                    document.getElementById("agi2-count").textContent =
                        files.length +
                        " result" +
                        (files.length !== 1 ? "s" : "");
                } else {
                    updateAgi2TabCounts();
                }

                // Pagination
                var totalPages = Math.max(
                    1,
                    Math.ceil(files.length / AGI2_PER_PAGE),
                );
                if (agi2Page >= totalPages) agi2Page = totalPages - 1;
                if (agi2Page < 0) agi2Page = 0;

                var start = agi2Page * AGI2_PER_PAGE;
                var end = Math.min(start + AGI2_PER_PAGE, files.length);
                var pageFiles = files.slice(start, end);

                if (files.length === 0) {
                    agi2Track.innerHTML = agi2Search
                        ? '<div class="empty-msg">No tasks match \u201c<code>' +
                          agi2Search +
                          "</code>\u201d</div>"
                        : '<div class="empty-msg">No tasks in this category.</div>';
                    agi2Pag.style.display = "none";
                    agi2Carousel.updateButtons();
                    return;
                }

                // Show/hide pagination
                if (totalPages > 1) {
                    agi2Pag.style.display = "flex";
                    document.getElementById("agi2-pag-info").textContent =
                        agi2Page + 1 + "/" + totalPages;
                    document.getElementById("agi2-prev").disabled =
                        agi2Page === 0;
                    document.getElementById("agi2-next").disabled =
                        agi2Page >= totalPages - 1;
                } else {
                    agi2Pag.style.display = "none";
                }

                pageFiles.forEach(function (filename, i) {
                    var card = buildAgi2Card(filename, start + i);
                    card.classList.add("card-enter");
                    card.style.animationDelay = i * 0.04 + "s";
                    agi2Track.appendChild(card);
                });

                // Reset scroll position for new page
                agi2Track.scrollLeft = 0;
                setTimeout(function () {
                    agi2Carousel.updateButtons();
                }, 80);
            }

            function buildAgi2Card(filename, globalIdx) {
                var card = document.createElement("div");
                card.className = "g-card agi2-card";

                var taskId = filename.replace(".json", "");

                // Preview
                // Admin delete button
                var delBtn = document.createElement("button");
                delBtn.className = "card-delete-btn";
                delBtn.textContent = "✕";
                delBtn.title = "Delete " + taskId;
                (function (cat, fn, el) {
                    delBtn.addEventListener("click", function (e) {
                        e.stopPropagation();
                        deleteAgi2Task(cat, fn, el);
                    });
                })(agi2Category, filename, card);
                card.appendChild(delBtn);

                var previewDiv = document.createElement("div");
                previewDiv.className = "g-card-preview";
                previewDiv.innerHTML =
                    '<div class="loading-text">LOADING\u2026</div>';

                var overlay = document.createElement("div");
                overlay.className = "card-overlay";
                overlay.innerHTML =
                    '<div class="play-circle agi2-play">\u25B6</div>';
                previewDiv.appendChild(overlay);

                var img = new Image();
                img.onload = function () {
                    var lt = previewDiv.querySelector(".loading-text");
                    if (lt) lt.remove();
                    previewDiv.insertBefore(img, previewDiv.firstChild);
                };
                img.onerror = function () {
                    var lt = previewDiv.querySelector(".loading-text");
                    if (lt) lt.textContent = "NO PREVIEW";
                };
                img.src =
                    "/api/agi2/task-preview/" +
                    encodeURIComponent(agi2Category) +
                    "/" +
                    encodeURIComponent(filename);

                // Info
                var info = document.createElement("div");
                info.className = "g-card-info";

                var idEl = document.createElement("div");
                idEl.className = "g-card-id";
                idEl.textContent = taskId;

                info.appendChild(idEl);

                card.appendChild(previewDiv);
                card.appendChild(info);

                // Click → open AGI-2 directly with this task
                card.addEventListener("click", function () {
                    window.location.href =
                        "/arc-agi-2/?task=" +
                        encodeURIComponent(agi2Category) +
                        "/" +
                        encodeURIComponent(filename);
                });

                return card;
            }

            // ── AGI-2 Tab switching ──
            document
                .getElementById("agi2-tabs")
                .addEventListener("click", function (e) {
                    var btn = e.target.closest(".cat-tab");
                    if (!btn) return;
                    var cat = btn.getAttribute("data-cat");
                    if (cat === agi2Category) return;

                    document
                        .querySelectorAll("#agi2-tabs .cat-tab")
                        .forEach(function (t) {
                            t.classList.remove("active");
                        });
                    btn.classList.add("active");

                    agi2Category = cat;
                    agi2Page = 0;
                    renderAgi2();
                });

            // ── AGI-2 Search (debounced) ──
            (function () {
                var timer = null;
                var _agi2Search = document.getElementById("agi2-search");
                if (_agi2Search) {
                    _agi2Search.addEventListener("input", function () {
                        var val = this.value.trim();
                        clearTimeout(timer);
                        timer = setTimeout(function () {
                            agi2Search = val;
                            agi2Page = 0;
                            renderAgi2();
                        }, 200);
                    });
                }
            })();

            // ── AGI-2 Pagination ──
            document
                .getElementById("agi2-prev")
                .addEventListener("click", function () {
                    if (agi2Page > 0) {
                        agi2Page--;
                        renderAgi2();
                    }
                });
            document
                .getElementById("agi2-next")
                .addEventListener("click", function () {
                    var files = getAgi2Files();
                    var totalPages = Math.ceil(files.length / AGI2_PER_PAGE);
                    if (agi2Page < totalPages - 1) {
                        agi2Page++;
                        renderAgi2();
                    }
                });

            // ── AGI-2 Upload ──
            document
                .getElementById("agi2-upload")
                .addEventListener("change", function (e) {
                    var file = e.target.files[0];
                    if (!file) return;

                    if (!file.name.endsWith(".json")) {
                        alert("Please upload a .json task file.");
                        e.target.value = "";
                        return;
                    }

                    var reader = new FileReader();
                    reader.onload = function (ev) {
                        try {
                            var data = JSON.parse(ev.target.result);
                            if (!data.train || !data.test)
                                throw new Error("Missing train/test");
                            sessionStorage.setItem(
                                "agi2_upload_task",
                                ev.target.result,
                            );
                            sessionStorage.setItem(
                                "agi2_upload_name",
                                file.name,
                            );
                            window.location.href = "/arc-agi-2/?uploaded=1";
                        } catch (err) {
                            alert("Invalid task file: " + err.message);
                        }
                    };
                    reader.readAsText(file);
                    e.target.value = "";
                });

            // ══════════════════════════════════════════════════════════════
            //  TOAST
            // ══════════════════════════════════════════════════════════════
            var _toastTimer = null;
            function showToast(msg, type, ms) {
                ms = ms || 2500;
                var el = document.getElementById("toast");
                el.textContent = msg;
                el.className = "show" + (type ? " toast-" + type : "");
                clearTimeout(_toastTimer);
                _toastTimer = setTimeout(function () {
                    el.className = "";
                }, ms);
            }

            // ══════════════════════════════════════════════════════════════
            //  ADMIN — login, logout, delete
            // ══════════════════════════════════════════════════════════════
            var adminCreds = { username: null, password: null };
            var adminLoggedIn = false;

            var adminModal = document.getElementById("admin-modal");
            var adminUserEl = document.getElementById("admin-user");
            var adminPassEl = document.getElementById("admin-pass");
            var adminStatusEl = document.getElementById("admin-status");
            var adminLoginBtn = document.getElementById("admin-login-btn");
            var btnAdmin = document.getElementById("btn-admin");
            var btnLogout = document.getElementById("btn-logout");

            btnAdmin.addEventListener("click", function () {
                if (adminLoggedIn) {
                    // Toggle admin mode off
                    adminLogout();
                } else {
                    adminModal.classList.add("show");
                    adminUserEl.value = "";
                    adminPassEl.value = "";
                    adminStatusEl.textContent = "";
                    adminUserEl.focus();
                }
            });

            document
                .getElementById("admin-cancel")
                .addEventListener("click", function () {
                    adminModal.classList.remove("show");
                });

            adminModal.addEventListener("click", function (e) {
                if (e.target === adminModal)
                    adminModal.classList.remove("show");
            });

            adminPassEl.addEventListener("keydown", function (e) {
                if (e.key === "Enter") doAdminLogin();
            });
            adminUserEl.addEventListener("keydown", function (e) {
                if (e.key === "Enter") adminPassEl.focus();
            });
            adminLoginBtn.addEventListener("click", doAdminLogin);

            function doAdminLogin() {
                var user = adminUserEl.value.trim();
                var pass = adminPassEl.value;
                if (!user || !pass) {
                    adminStatusEl.textContent = "Enter username and password";
                    adminStatusEl.className = "admin-status err";
                    return;
                }
                adminLoginBtn.disabled = true;
                adminStatusEl.textContent = "Authenticating…";
                adminStatusEl.className = "admin-status";

                fetch("/api/admin/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username: user, password: pass }),
                })
                    .then(function (r) {
                        return r.json().then(function (d) {
                            return { ok: r.ok, data: d };
                        });
                    })
                    .then(function (res) {
                        adminLoginBtn.disabled = false;
                        if (res.ok) {
                            adminCreds = { username: user, password: pass };
                            adminLoggedIn = true;
                            try {
                                localStorage.setItem(
                                    "arc_admin",
                                    JSON.stringify(adminCreds),
                                );
                            } catch (e) {}
                            adminModal.classList.remove("show");
                            document.body.classList.add("admin-mode");
                            btnAdmin.classList.add("active");
                            btnAdmin.textContent = "🔓 Admin ON";
                            btnLogout.style.display = "";
                            showToast(
                                "Admin mode enabled — click ✕ on any card to delete",
                                "ok",
                                3500,
                            );
                        } else {
                            adminStatusEl.textContent =
                                "✗ " + (res.data.error || "Login failed");
                            adminStatusEl.className = "admin-status err";
                        }
                    })
                    .catch(function (e) {
                        adminLoginBtn.disabled = false;
                        adminStatusEl.textContent = "✗ " + e.message;
                        adminStatusEl.className = "admin-status err";
                    });
            }

            btnLogout.addEventListener("click", adminLogout);

            function adminLogout() {
                adminCreds = { username: null, password: null };
                adminLoggedIn = false;
                try {
                    localStorage.removeItem("arc_admin");
                } catch (e) {}
                document.body.classList.remove("admin-mode");
                btnAdmin.classList.remove("active");
                btnAdmin.textContent = "🔒 Admin";
                btnLogout.style.display = "none";
                showToast("Admin mode disabled", "", 1500);
            }

            // ── Delete AGI-3 game ──
            function deleteAgi3Game(gameId, cardEl) {
                if (
                    !confirm(
                        'Delete game "' + gameId + '"?\nThis cannot be undone.',
                    )
                )
                    return;
                var delBtn = cardEl.querySelector(".card-delete-btn");
                if (delBtn) {
                    delBtn.textContent = "…";
                    delBtn.style.pointerEvents = "none";
                }

                fetch("/api/admin/games/" + encodeURIComponent(gameId), {
                    method: "DELETE",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        username: adminCreds.username,
                        password: adminCreds.password,
                    }),
                })
                    .then(function (r) {
                        return r.json().then(function (d) {
                            return { ok: r.ok, data: d };
                        });
                    })
                    .then(function (res) {
                        if (res.ok) {
                            cardEl.style.transition = "all 0.3s";
                            cardEl.style.opacity = "0";
                            cardEl.style.transform = "scale(0.8)";
                            setTimeout(function () {
                                cardEl.remove();
                                agi3Carousel.updateButtons();
                            }, 300);
                            showToast("Deleted game: " + gameId, "ok");
                            // Refresh game list
                            fetchAgi3Games();
                        } else {
                            showToast(
                                "Error: " + (res.data.error || "Delete failed"),
                                "err",
                                4000,
                            );
                            if (delBtn) {
                                delBtn.textContent = "✕";
                                delBtn.style.pointerEvents = "";
                            }
                        }
                    })
                    .catch(function (e) {
                        showToast("Error: " + e.message, "err", 4000);
                        if (delBtn) {
                            delBtn.textContent = "✕";
                            delBtn.style.pointerEvents = "";
                        }
                    });
            }

            // ── Delete AGI-2 task ──
            function deleteAgi2Task(category, filename, cardEl) {
                if (
                    !confirm(
                        'Delete task "' +
                            filename.replace(".json", "") +
                            '" from ' +
                            category +
                            "?\nThis cannot be undone.",
                    )
                )
                    return;
                var delBtn = cardEl.querySelector(".card-delete-btn");
                if (delBtn) {
                    delBtn.textContent = "…";
                    delBtn.style.pointerEvents = "none";
                }

                fetch(
                    "/api/admin/agi2/tasks/" +
                        encodeURIComponent(category) +
                        "/" +
                        encodeURIComponent(filename),
                    {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            username: adminCreds.username,
                            password: adminCreds.password,
                        }),
                    },
                )
                    .then(function (r) {
                        return r.json().then(function (d) {
                            return { ok: r.ok, data: d };
                        });
                    })
                    .then(function (res) {
                        if (res.ok) {
                            cardEl.style.transition = "all 0.3s";
                            cardEl.style.opacity = "0";
                            cardEl.style.transform = "scale(0.8)";
                            setTimeout(function () {
                                cardEl.remove();
                                agi2Carousel.updateButtons();
                            }, 300);
                            showToast(
                                "Deleted task: " +
                                    filename.replace(".json", ""),
                                "ok",
                            );
                            // Refresh task index
                            fetchAgi2Index();
                        } else {
                            showToast(
                                "Error: " + (res.data.error || "Delete failed"),
                                "err",
                                4000,
                            );
                            if (delBtn) {
                                delBtn.textContent = "✕";
                                delBtn.style.pointerEvents = "";
                            }
                        }
                    })
                    .catch(function (e) {
                        showToast("Error: " + e.message, "err", 4000);
                        if (delBtn) {
                            delBtn.textContent = "✕";
                            delBtn.style.pointerEvents = "";
                        }
                    });
            }

            // ══════════════════════════════════════════════════════════════
            //  RANDOM TASK / GAME
            // ══════════════════════════════════════════════════════════════

            function randomAgi2Task() {
                if (!agi2Index) {
                    showToast("Tasks not loaded yet", "err");
                    return;
                }
                var cats = ["my_tasks", "training", "evaluation"];
                var allFiles = [];
                cats.forEach(function (c) {
                    (agi2Index[c] || []).forEach(function (f) {
                        allFiles.push({ cat: c, file: f });
                    });
                });
                if (allFiles.length === 0) {
                    showToast("No tasks available", "err");
                    return;
                }
                var pick =
                    allFiles[Math.floor(Math.random() * allFiles.length)];
                showToast(
                    "\uD83C\uDFB2 Random: " + pick.file.replace(".json", ""),
                    "ok",
                    1500,
                );
                setTimeout(function () {
                    window.location.href =
                        "/arc-agi-2/?task=" +
                        encodeURIComponent(pick.cat) +
                        "/" +
                        encodeURIComponent(pick.file);
                }, 400);
            }

            function randomAgi3Game() {
                if (agi3Games.length === 0) {
                    showToast("No games available", "err");
                    return;
                }
                var pick =
                    agi3Games[Math.floor(Math.random() * agi3Games.length)];
                showToast("\uD83C\uDFB2 Random: " + pick.game_id, "ok", 1500);
                setTimeout(function () {
                    window.location.href =
                        "/arc-agi-3/game/" + encodeURIComponent(pick.game_id);
                }, 400);
            }

            var _agi2Random = document.getElementById("agi2-random");
            if (_agi2Random)
                _agi2Random.addEventListener("click", randomAgi2Task);
            var _agi3Random = document.getElementById("agi3-random");
            if (_agi3Random)
                _agi3Random.addEventListener("click", randomAgi3Game);

            // ══════════════════════════════════════════════════════════════
            //  KEYBOARD HELP PANEL
            // ══════════════════════════════════════════════════════════════

            var kbPanel = document.getElementById("kb-panel");

            document
                .getElementById("btn-kb-help")
                .addEventListener("click", function () {
                    kbPanel.classList.toggle("show");
                });
            document
                .getElementById("kb-close")
                .addEventListener("click", function () {
                    kbPanel.classList.remove("show");
                });
            kbPanel.addEventListener("click", function (e) {
                if (e.target === kbPanel) kbPanel.classList.remove("show");
            });

            // ══════════════════════════════════════════════════════════════
            //  KEYBOARD SHORTCUTS
            // ══════════════════════════════════════════════════════════════

            document.addEventListener("keydown", function (e) {
                var tag = (e.target.tagName || "").toLowerCase();
                var inInput =
                    tag === "input" || tag === "textarea" || tag === "select";

                // ESC — close any modal/panel
                if (e.key === "Escape") {
                    if (uploadModal.classList.contains("show")) {
                        closeUploadModal();
                        return;
                    }
                    if (kbPanel.classList.contains("show")) {
                        kbPanel.classList.remove("show");
                        return;
                    }
                    if (adminModal.classList.contains("show")) {
                        adminModal.classList.remove("show");
                        return;
                    }
                    return;
                }

                // Skip other shortcuts if typing in an input
                if (inInput) return;

                // ? — toggle keyboard help
                if (e.key === "?") {
                    e.preventDefault();
                    kbPanel.classList.toggle("show");
                    return;
                }

                // / — focus search (AGI-2 by default)
                if (e.key === "/") {
                    e.preventDefault();
                    var _s = document.getElementById("agi2-search");
                    if (_s) _s.focus();
                    return;
                }

                // R — random task or game
                if (e.key === "r" || e.key === "R") {
                    if (Math.random() < 0.5 && agi3Games.length > 0) {
                        randomAgi3Game();
                    } else {
                        randomAgi2Task();
                    }
                    return;
                }

                // Arrow keys — scroll both carousels
                if (e.key === "ArrowLeft") {
                    e.preventDefault();
                    document.getElementById("agi2-left").click();
                    document.getElementById("agi3-left").click();
                    return;
                }
                if (e.key === "ArrowRight") {
                    e.preventDefault();
                    document.getElementById("agi2-right").click();
                    document.getElementById("agi3-right").click();
                    return;
                }

                // [ ] — AGI-2 pagination
                if (e.key === "[") {
                    e.preventDefault();
                    document.getElementById("agi2-prev").click();
                    return;
                }
                if (e.key === "]") {
                    e.preventDefault();
                    document.getElementById("agi2-next").click();
                    return;
                }

                // 1, 2, 3 — switch AGI-2 category tabs
                if (e.key === "1") {
                    var t1 = document.querySelectorAll("#agi2-tabs .cat-tab");
                    if (t1[0]) t1[0].click();
                    return;
                }
                if (e.key === "2") {
                    var t2 = document.querySelectorAll("#agi2-tabs .cat-tab");
                    if (t2[1]) t2[1].click();
                    return;
                }
                if (e.key === "3") {
                    var t3 = document.querySelectorAll("#agi2-tabs .cat-tab");
                    if (t3[2]) t3[2].click();
                    return;
                }
            });

            // ══════════════════════════════════════════════════════════════
            //  PERSISTENT ADMIN SESSION (localStorage)
            // ══════════════════════════════════════════════════════════════

            function restoreAdminSession() {
                try {
                    var saved = localStorage.getItem("arc_admin");
                    if (!saved) return;
                    var creds = JSON.parse(saved);
                    if (!creds.username || !creds.password) return;

                    // Verify credentials are still valid
                    fetch("/api/admin/login", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(creds),
                    })
                        .then(function (r) {
                            return r.json().then(function (d) {
                                return { ok: r.ok, data: d };
                            });
                        })
                        .then(function (res) {
                            if (res.ok) {
                                adminCreds = creds;
                                adminLoggedIn = true;
                                document.body.classList.add("admin-mode");
                                btnAdmin.classList.add("active");
                                btnAdmin.textContent = "\uD83D\uDD13 Admin ON";
                                btnLogout.style.display = "";
                            } else {
                                localStorage.removeItem("arc_admin");
                            }
                        })
                        .catch(function () {
                            // Silently fail on network error
                        });
                } catch (e) {
                    // localStorage not available
                }
            }

            // ══════════════════════════════════════════════════════════════
            //  INIT
            // ══════════════════════════════════════════════════════════════
            fetchAgi3Games();
            fetchAgi2Index();
            restoreAdminSession();
        </script>
    </body>
</html>
