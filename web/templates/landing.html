<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ethara AI √ó ARC</title>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Press+Start+2P&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap");

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            :root {
                --bg: #0e1117;
                --panel: #161b22;
                --panel2: #1c2129;
                --border: #30363d;
                --text: #c9d1d9;
                --text-dim: #8b949e;
                --text-bright: #f0f6fc;
                --accent: #58a6ff;
                --green: #3fb950;
                --green-dim: #238636;
                --purple: #bc8cff;
                --purple-dim: rgba(188, 140, 255, 0.15);
                --orange: #f0883e;
                --red: #f85149;
                --mono: "Share Tech Mono", "Courier New", monospace;
                --pixel: "Press Start 2P", monospace;
                --sans: "Inter", sans-serif;
                --code: "JetBrains Mono", monospace;
            }

            html,
            body {
                height: 100%;
                overflow: hidden;
                background: var(--bg);
                color: var(--text);
                font-family: var(--mono);
            }

            /* ‚ïê‚ïê‚ïê TOP BAR ‚ïê‚ïê‚ïê */
            #topbar {
                display: flex;
                align-items: center;
                gap: 16px;
                padding: 0 28px;
                background: var(--panel);
                border-bottom: 1px solid var(--border);
                height: 48px;
                flex-shrink: 0;
                z-index: 100;
            }
            .logo {
                font-family: var(--pixel);
                font-size: 11px;
                color: var(--accent);
                white-space: nowrap;
                text-decoration: none;
                cursor: pointer;
            }
            .sep {
                width: 1px;
                height: 20px;
                background: var(--border);
            }
            .tagline {
                font-size: 12px;
                color: var(--text-dim);
            }
            .spacer {
                flex: 1;
            }

            /* ‚ïê‚ïê‚ïê TOP BAR BUTTONS ‚ïê‚ïê‚ïê */
            .top-btn {
                font-family: var(--code);
                font-size: 10px;
                padding: 6px 14px;
                border-radius: 6px;
                border: 1px solid var(--border);
                background: transparent;
                color: var(--text-dim);
                cursor: pointer;
                transition: all 0.15s;
                text-decoration: none;
                white-space: nowrap;
            }
            .top-btn:hover {
                border-color: var(--accent);
                color: var(--text-bright);
                background: rgba(88, 166, 255, 0.06);
            }
            .top-btn-admin {
                color: var(--orange);
                border-color: rgba(240, 136, 62, 0.3);
            }
            .top-btn-admin:hover {
                border-color: var(--orange);
                background: rgba(240, 136, 62, 0.08);
                color: var(--orange);
            }
            .top-btn-admin.active {
                background: rgba(240, 136, 62, 0.12);
                border-color: var(--orange);
                color: var(--orange);
                box-shadow: 0 0 10px rgba(240, 136, 62, 0.15);
            }
            .top-btn-logout {
                color: var(--red);
                border-color: rgba(248, 81, 73, 0.3);
            }
            .top-btn-logout:hover {
                border-color: var(--red);
                background: rgba(248, 81, 73, 0.08);
            }

            /* ‚ïê‚ïê‚ïê ADMIN LOGIN MODAL ‚ïê‚ïê‚ïê */
            #admin-modal {
                display: none;
                position: fixed;
                inset: 0;
                z-index: 1000;
                background: rgba(0, 0, 0, 0.7);
                backdrop-filter: blur(6px);
                align-items: center;
                justify-content: center;
            }
            #admin-modal.show {
                display: flex;
            }
            .admin-box {
                background: var(--panel);
                border: 1px solid var(--border);
                border-radius: 14px;
                padding: 32px;
                width: 360px;
                max-width: 90vw;
                display: flex;
                flex-direction: column;
                gap: 18px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            }
            .admin-box h2 {
                font-family: var(--pixel);
                font-size: 13px;
                color: var(--orange);
                text-align: center;
                letter-spacing: 1px;
            }
            .admin-input {
                width: 100%;
                padding: 10px 14px;
                font-family: var(--code);
                font-size: 12px;
                color: var(--text);
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 6px;
                outline: none;
                transition:
                    border-color 0.2s,
                    box-shadow 0.2s;
            }
            .admin-input:focus {
                border-color: var(--orange);
                box-shadow: 0 0 0 3px rgba(240, 136, 62, 0.12);
            }
            .admin-input::placeholder {
                color: #444;
            }
            .admin-submit {
                width: 100%;
                padding: 10px;
                font-family: var(--pixel);
                font-size: 10px;
                letter-spacing: 1px;
                color: #fff;
                background: linear-gradient(135deg, var(--orange), #e06820);
                border: none;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.2s;
            }
            .admin-submit:hover {
                box-shadow: 0 4px 20px rgba(240, 136, 62, 0.3);
                transform: translateY(-1px);
            }
            .admin-submit:disabled {
                opacity: 0.5;
                cursor: default;
                transform: none;
                box-shadow: none;
            }
            .admin-status {
                font-family: var(--code);
                font-size: 11px;
                text-align: center;
                min-height: 16px;
            }
            .admin-status.err {
                color: var(--red);
            }
            .admin-status.ok {
                color: var(--green);
            }
            .admin-cancel {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                background: none;
                border: none;
                cursor: pointer;
                text-align: center;
                padding: 4px;
            }
            .admin-cancel:hover {
                color: var(--text-bright);
            }

            /* ‚ïê‚ïê‚ïê CARD DELETE BADGE (admin mode) ‚ïê‚ïê‚ïê */
            .card-delete-btn {
                display: none;
                position: absolute;
                top: 8px;
                right: 8px;
                z-index: 20;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                border: 2px solid var(--red);
                background: rgba(248, 81, 73, 0.15);
                color: var(--red);
                font-size: 14px;
                cursor: pointer;
                align-items: center;
                justify-content: center;
                transition: all 0.15s;
                backdrop-filter: blur(4px);
                line-height: 1;
            }
            .card-delete-btn:hover {
                background: var(--red);
                color: #fff;
                box-shadow: 0 0 16px rgba(248, 81, 73, 0.4);
                transform: scale(1.1);
            }
            body.admin-mode .card-delete-btn {
                display: flex;
            }

            /* ‚ïê‚ïê‚ïê TOAST NOTIFICATION ‚ïê‚ïê‚ïê */
            #toast {
                position: fixed;
                bottom: 24px;
                left: 50%;
                transform: translateX(-50%) translateY(80px);
                z-index: 2000;
                font-family: var(--code);
                font-size: 12px;
                padding: 10px 24px;
                border-radius: 8px;
                background: var(--panel2);
                color: var(--text-bright);
                border: 1px solid var(--border);
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
                opacity: 0;
                transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
                pointer-events: none;
                white-space: nowrap;
            }
            #toast.show {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            #toast.toast-ok {
                border-color: var(--green);
                color: var(--green);
            }
            #toast.toast-err {
                border-color: var(--red);
                color: var(--red);
            }

            /* ‚ïê‚ïê‚ïê APP LAYOUT ‚ïê‚ïê‚ïê */
            #app {
                display: flex;
                flex-direction: column;
                height: 100vh;
            }
            #content {
                flex: 1;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                min-height: 0;
            }

            /* ‚ïê‚ïê‚ïê SECTION PANELS (top / bottom) ‚ïê‚ïê‚ïê */
            .section-panel {
                flex: 1;
                display: flex;
                flex-direction: column;
                min-height: 0;
                overflow: hidden;
                position: relative;
            }

            /* ‚îÄ‚îÄ Thick visual divider between sections ‚îÄ‚îÄ */
            .section-divider {
                flex-shrink: 0;
                height: 3px;
                background: linear-gradient(
                    90deg,
                    var(--purple) 0%,
                    var(--accent) 50%,
                    var(--green) 100%
                );
                box-shadow:
                    0 0 12px rgba(88, 166, 255, 0.3),
                    0 0 24px rgba(88, 166, 255, 0.1);
            }

            /* ‚ïê‚ïê‚ïê SECTION HEADER ‚ïê‚ïê‚ïê */
            .section-header {
                flex-shrink: 0;
                display: flex;
                align-items: center;
                gap: 20px;
                padding: 14px 28px 12px;
                border-bottom: 1px solid var(--border);
                background: var(--panel);
            }

            /* ‚îÄ‚îÄ Large prominent badge ‚îÄ‚îÄ */
            .section-badge {
                font-family: var(--pixel);
                font-size: 13px;
                letter-spacing: 2px;
                padding: 8px 18px;
                border-radius: 6px;
                white-space: nowrap;
                flex-shrink: 0;
                text-transform: uppercase;
            }
            .badge-purple {
                background: linear-gradient(
                    135deg,
                    rgba(188, 140, 255, 0.2),
                    rgba(188, 140, 255, 0.08)
                );
                color: var(--purple);
                border: 2px solid rgba(188, 140, 255, 0.5);
                box-shadow:
                    0 0 16px rgba(188, 140, 255, 0.2),
                    inset 0 0 12px rgba(188, 140, 255, 0.06);
            }
            .badge-green {
                background: linear-gradient(
                    135deg,
                    rgba(63, 185, 80, 0.2),
                    rgba(63, 185, 80, 0.08)
                );
                color: var(--green);
                border: 2px solid rgba(63, 185, 80, 0.5);
                box-shadow:
                    0 0 16px rgba(63, 185, 80, 0.2),
                    inset 0 0 12px rgba(63, 185, 80, 0.06);
            }

            /* ‚îÄ‚îÄ Title + count ‚îÄ‚îÄ */
            .section-title-group {
                display: flex;
                flex-direction: column;
                gap: 2px;
                flex-shrink: 0;
            }
            .section-title {
                font-family: var(--pixel);
                font-size: 14px;
                color: var(--text-bright);
                letter-spacing: 0.5px;
            }
            .section-subtitle {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .section-count {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                opacity: 0.8;
            }

            .section-desc {
                font-size: 11px;
                color: var(--text-dim);
                line-height: 1.5;
                flex: 1;
                min-width: 120px;
            }

            /* ‚îÄ‚îÄ Category tabs ‚îÄ‚îÄ */
            .cat-tabs {
                display: flex;
                gap: 2px;
                flex-shrink: 0;
                background: rgba(255, 255, 255, 0.03);
                border-radius: 6px;
                padding: 3px;
            }
            .cat-tab {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                background: none;
                border: none;
                border-radius: 4px;
                padding: 6px 14px;
                cursor: pointer;
                transition: all 0.15s;
                display: flex;
                align-items: center;
                gap: 6px;
                white-space: nowrap;
            }
            .cat-tab:hover {
                color: var(--text-bright);
                background: rgba(255, 255, 255, 0.04);
            }
            .cat-tab.active {
                color: var(--purple);
                background: rgba(188, 140, 255, 0.1);
                box-shadow: 0 0 0 1px rgba(188, 140, 255, 0.3);
            }
            .cat-tab .ct-count {
                font-size: 9px;
                background: rgba(255, 255, 255, 0.06);
                color: inherit;
                padding: 1px 6px;
                border-radius: 8px;
                opacity: 0.7;
            }
            .cat-tab.active .ct-count {
                background: rgba(188, 140, 255, 0.2);
                opacity: 1;
            }

            /* ‚îÄ‚îÄ Controls (search, upload, pagination) ‚îÄ‚îÄ */
            .section-controls {
                display: flex;
                align-items: center;
                gap: 10px;
                flex-shrink: 0;
                margin-left: auto;
            }
            .search-box {
                width: 200px;
                padding: 7px 12px;
                font-family: var(--code);
                font-size: 11px;
                color: var(--text);
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 6px;
                outline: none;
                transition:
                    border-color 0.2s,
                    box-shadow 0.2s;
            }
            .search-box:focus {
                border-color: var(--accent);
                box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
            }
            .search-box::placeholder {
                color: #444;
            }

            .upload-btn {
                font-family: var(--code);
                font-size: 10px;
                padding: 7px 14px;
                background: transparent;
                border: 1px dashed var(--border);
                color: var(--text-dim);
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.15s;
                white-space: nowrap;
                display: inline-flex;
                align-items: center;
                gap: 5px;
            }
            .upload-btn:hover {
                border-color: var(--accent);
                color: var(--text-bright);
                background: rgba(88, 166, 255, 0.05);
            }
            .upload-btn input[type="file"] {
                display: none;
            }

            .pag-row {
                display: flex;
                align-items: center;
                gap: 6px;
                flex-shrink: 0;
            }
            .pag-btn {
                font-family: var(--code);
                font-size: 11px;
                color: var(--text-dim);
                background: var(--panel2);
                border: 1px solid var(--border);
                border-radius: 4px;
                padding: 4px 10px;
                cursor: pointer;
                transition: all 0.15s;
            }
            .pag-btn:hover:not(:disabled) {
                border-color: var(--accent);
                color: var(--text-bright);
            }
            .pag-btn:disabled {
                color: #333;
                cursor: default;
                border-color: rgba(48, 54, 61, 0.4);
            }
            .pag-info {
                font-family: var(--code);
                font-size: 10px;
                color: #555;
            }

            /* ‚ïê‚ïê‚ïê CAROUSEL ‚ïê‚ïê‚ïê */
            .carousel-wrapper {
                flex: 1;
                display: flex;
                align-items: center;
                overflow: hidden;
                min-height: 0;
                position: relative;
                padding: 0 8px;
            }

            .carousel-btn {
                flex-shrink: 0;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                border: 1px solid var(--border);
                background: var(--panel);
                color: var(--text-dim);
                font-size: 20px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.15s;
                z-index: 5;
                user-select: none;
            }
            .carousel-btn:hover:not(:disabled) {
                border-color: var(--accent);
                color: var(--text-bright);
                background: var(--panel2);
                box-shadow: 0 0 12px rgba(88, 166, 255, 0.15);
            }
            .carousel-btn:disabled {
                opacity: 0.2;
                cursor: default;
            }

            .carousel-track {
                flex: 1;
                display: flex;
                gap: 24px;
                overflow-x: auto;
                overflow-y: hidden;
                scroll-behavior: smooth;
                padding: 24px 20px;
                min-height: 0;
                align-items: center;
                justify-content: center;
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .carousel-track::-webkit-scrollbar {
                display: none;
            }
            /* When cards overflow, align to start for scroll */
            .carousel-track.has-overflow {
                justify-content: flex-start;
            }

            /* ‚ïê‚ïê‚ïê GAME / TASK CARD ‚ïê‚ïê‚ïê */
            .g-card {
                flex-shrink: 0;
                width: 280px;
                height: 370px;
                background: var(--panel);
                border: 1px solid rgba(255, 255, 255, 0.06);
                cursor: pointer;
                transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
                overflow: hidden;
                display: flex;
                flex-direction: column;
                position: relative;
                border-radius: 14px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            }
            .g-card:hover {
                transform: translateY(-6px) scale(1.02);
            }
            .g-card.agi3-card:hover {
                border-color: rgba(63, 185, 80, 0.5);
                box-shadow:
                    0 12px 40px rgba(63, 185, 80, 0.2),
                    0 0 0 1px rgba(63, 185, 80, 0.12),
                    0 0 60px rgba(63, 185, 80, 0.06);
            }
            .g-card.agi2-card:hover {
                border-color: rgba(188, 140, 255, 0.5);
                box-shadow:
                    0 12px 40px rgba(188, 140, 255, 0.2),
                    0 0 0 1px rgba(188, 140, 255, 0.12),
                    0 0 60px rgba(188, 140, 255, 0.06);
            }

            /* ‚îÄ‚îÄ Card Preview ‚îÄ‚îÄ */
            .g-card-preview {
                position: relative;
                width: 100%;
                flex: 1;
                min-height: 0;
                background: #06080c;
                overflow: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
                border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            }
            .g-card-preview img,
            .g-card-preview canvas {
                width: 100%;
                height: 100%;
                object-fit: contain;
                image-rendering: pixelated;
                image-rendering: crisp-edges;
                transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            }
            .g-card:hover .g-card-preview img,
            .g-card:hover .g-card-preview canvas {
                transform: scale(1.08);
            }
            .g-card-preview .loading-text {
                font-family: var(--code);
                font-size: 11px;
                color: #2a2e36;
                letter-spacing: 3px;
                text-transform: uppercase;
            }

            /* Play overlay */
            .card-overlay {
                position: absolute;
                inset: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(6, 8, 12, 0.65);
                opacity: 0;
                transition: opacity 0.3s;
            }
            .g-card:hover .card-overlay {
                opacity: 1;
            }
            .play-circle {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 22px;
                color: #fff;
                transition: transform 0.25s cubic-bezier(0.23, 1, 0.32, 1);
                backdrop-filter: blur(6px);
            }
            .agi3-play {
                background: rgba(63, 185, 80, 0.25);
                border: 2px solid rgba(63, 185, 80, 0.7);
                box-shadow:
                    0 0 24px rgba(63, 185, 80, 0.3),
                    inset 0 0 12px rgba(63, 185, 80, 0.1);
            }
            .agi2-play {
                background: rgba(188, 140, 255, 0.18);
                border: 2px solid rgba(188, 140, 255, 0.7);
                box-shadow:
                    0 0 24px rgba(188, 140, 255, 0.3),
                    inset 0 0 12px rgba(188, 140, 255, 0.1);
            }
            .g-card:hover .play-circle {
                transform: scale(1.12);
            }

            /* ‚îÄ‚îÄ Card Info ‚îÄ‚îÄ */
            .g-card-info {
                padding: 14px 16px 16px;
                display: flex;
                flex-direction: column;
                gap: 8px;
                background: var(--panel);
                flex-shrink: 0;
                min-height: 90px;
            }
            .g-card-id {
                font-family: var(--pixel);
                font-size: 11px;
                letter-spacing: 0.5px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .agi3-card .g-card-id {
                color: var(--green);
            }
            .agi2-card .g-card-id {
                color: var(--purple);
            }

            .g-card-tags {
                display: flex;
                flex-wrap: wrap;
                gap: 5px;
            }
            .g-tag {
                font-family: var(--code);
                font-size: 9px;
                padding: 3px 8px;
                border-radius: 4px;
                letter-spacing: 0.3px;
            }
            .agi3-card .g-tag {
                background: rgba(63, 185, 80, 0.08);
                border: 1px solid rgba(63, 185, 80, 0.18);
                color: rgba(63, 185, 80, 0.8);
            }
            .agi2-card .g-tag {
                background: rgba(188, 140, 255, 0.08);
                border: 1px solid rgba(188, 140, 255, 0.18);
                color: rgba(188, 140, 255, 0.8);
            }

            /* ‚îÄ‚îÄ Empty state ‚îÄ‚îÄ */
            .empty-msg {
                flex-shrink: 0;
                padding: 30px 20px;
                color: var(--text-dim);
                font-size: 12px;
                line-height: 1.6;
                text-align: center;
                width: 100%;
            }
            .empty-msg code {
                font-family: var(--code);
                background: rgba(255, 255, 255, 0.06);
                padding: 2px 6px;
                border-radius: 3px;
            }

            /* ‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê */
            #footer {
                padding: 6px 28px;
                text-align: center;
                border-top: 1px solid var(--border);
                font-size: 10px;
                color: var(--text-dim);
                flex-shrink: 0;
                background: var(--panel);
            }
            #footer a {
                color: var(--accent);
                text-decoration: none;
            }
            #footer a:hover {
                text-decoration: underline;
            }

            /* ‚ïê‚ïê‚ïê RESPONSIVE ‚ïê‚ïê‚ïê */
            @media (max-width: 1100px) {
                .section-desc {
                    display: none;
                }
                .section-header {
                    gap: 14px;
                    padding: 12px 20px 10px;
                }
            }

            @media (max-width: 900px) {
                .section-header {
                    gap: 10px;
                    padding: 10px 16px 8px;
                    flex-wrap: wrap;
                }
                .section-badge {
                    font-size: 10px;
                    padding: 6px 12px;
                }
                .section-title {
                    font-size: 12px;
                }
                .search-box {
                    width: 150px;
                }
                .g-card {
                    width: 230px;
                    height: 320px;
                }
                .carousel-track {
                    gap: 18px;
                    padding: 16px 12px;
                }
                .carousel-btn {
                    width: 34px;
                    height: 34px;
                    font-size: 17px;
                }
            }

            @media (max-width: 600px) {
                #topbar {
                    padding: 0 14px;
                    gap: 10px;
                    height: 42px;
                }
                .logo {
                    font-size: 9px;
                }
                .tagline {
                    display: none;
                }
                .section-header {
                    padding: 8px 12px 6px;
                    gap: 8px;
                }
                .section-badge {
                    font-size: 9px;
                    padding: 5px 10px;
                }
                .section-title {
                    font-size: 10px;
                }
                .section-subtitle {
                    font-size: 10px;
                }
                .section-desc {
                    display: none;
                }
                .cat-tabs {
                    padding: 2px;
                }
                .cat-tab {
                    font-size: 9px;
                    padding: 4px 8px;
                    gap: 4px;
                }
                .search-box {
                    width: 110px;
                    font-size: 10px;
                    padding: 5px 8px;
                }
                .g-card {
                    width: 190px;
                    height: 280px;
                    border-radius: 10px;
                }
                .carousel-btn {
                    width: 30px;
                    height: 30px;
                    font-size: 15px;
                }
                .carousel-track {
                    gap: 12px;
                    padding: 12px 8px;
                }
                .g-card-id {
                    font-size: 9px;
                }
                .g-card-info {
                    padding: 10px 12px 12px;
                    gap: 5px;
                    min-height: 70px;
                }
                .g-tag {
                    font-size: 7px;
                    padding: 2px 5px;
                }
                .play-circle {
                    width: 44px;
                    height: 44px;
                    font-size: 16px;
                }
                .section-divider {
                    height: 2px;
                }
            }

            /* ‚ïê‚ïê‚ïê CARD ENTRANCE ANIMATION ‚ïê‚ïê‚ïê */
            @keyframes cardFadeIn {
                from {
                    opacity: 0;
                    transform: translateY(18px) scale(0.96);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }
            .g-card.card-enter {
                animation: cardFadeIn 0.35s cubic-bezier(0.23, 1, 0.32, 1) both;
            }

            /* ‚ïê‚ïê‚ïê RANDOM BUTTON ‚ïê‚ïê‚ïê */
            .random-btn {
                font-size: 16px;
                width: 34px;
                height: 34px;
                border-radius: 8px;
                border: 1px solid var(--border);
                background: transparent;
                color: var(--text-dim);
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s;
                flex-shrink: 0;
                position: relative;
            }
            .random-btn:hover {
                border-color: var(--accent);
                color: var(--text-bright);
                background: rgba(88, 166, 255, 0.08);
                transform: rotate(15deg) scale(1.1);
            }
            .random-btn:active {
                transform: rotate(360deg) scale(0.95);
                transition: transform 0.4s;
            }
            .random-btn .random-tooltip {
                display: none;
                position: absolute;
                bottom: calc(100% + 6px);
                left: 50%;
                transform: translateX(-50%);
                font-family: var(--code);
                font-size: 9px;
                white-space: nowrap;
                background: var(--panel2);
                color: var(--text);
                border: 1px solid var(--border);
                border-radius: 4px;
                padding: 3px 8px;
                pointer-events: none;
            }
            .random-btn:hover .random-tooltip {
                display: block;
            }

            /* ‚ïê‚ïê‚ïê KEYBOARD HELP ‚ïê‚ïê‚ïê */
            .kb-help-btn {
                font-family: var(--code);
                font-size: 10px;
                padding: 6px 10px;
                border-radius: 6px;
                border: 1px solid var(--border);
                background: transparent;
                color: var(--text-dim);
                cursor: pointer;
                transition: all 0.15s;
                white-space: nowrap;
            }
            .kb-help-btn:hover {
                border-color: var(--accent);
                color: var(--text-bright);
                background: rgba(88, 166, 255, 0.06);
            }
            #kb-panel {
                display: none;
                position: fixed;
                inset: 0;
                z-index: 900;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(4px);
                align-items: center;
                justify-content: center;
            }
            #kb-panel.show {
                display: flex;
            }
            .kb-box {
                background: var(--panel);
                border: 1px solid var(--border);
                border-radius: 14px;
                padding: 28px 32px;
                width: 420px;
                max-width: 90vw;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            }
            .kb-box h2 {
                font-family: var(--pixel);
                font-size: 12px;
                color: var(--accent);
                text-align: center;
                margin-bottom: 20px;
                letter-spacing: 1px;
            }
            .kb-grid {
                display: grid;
                grid-template-columns: auto 1fr;
                gap: 8px 16px;
                align-items: center;
            }
            .kb-key {
                font-family: var(--code);
                font-size: 10px;
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 4px;
                padding: 3px 8px;
                color: var(--text-bright);
                text-align: center;
                white-space: nowrap;
            }
            .kb-desc {
                font-family: var(--code);
                font-size: 10px;
                color: var(--text-dim);
            }
            .kb-section-title {
                grid-column: 1 / -1;
                font-family: var(--code);
                font-size: 9px;
                color: var(--purple);
                text-transform: uppercase;
                letter-spacing: 1px;
                margin-top: 10px;
                padding-bottom: 4px;
                border-bottom: 1px solid rgba(188, 140, 255, 0.15);
            }
            .kb-section-title:first-child {
                margin-top: 0;
            }
            .kb-close {
                display: block;
                margin: 20px auto 0;
                font-family: var(--code);
                font-size: 10px;
                color: var(--text-dim);
                background: none;
                border: none;
                cursor: pointer;
                padding: 6px 16px;
            }
            .kb-close:hover {
                color: var(--text-bright);
            }

            @media (max-width: 600px) {
                .random-btn {
                    width: 30px;
                    height: 30px;
                    font-size: 14px;
                }
                .kb-help-btn {
                    display: none;
                }
            }
        </style>
    </head>
    <body>
        <div id="app">
            <!-- ‚ïê‚ïê‚ïê TOP BAR ‚ïê‚ïê‚ïê -->
            <div id="topbar">
                <a href="/" class="logo">Ethara AI √ó ARC</a>
                <div class="sep"></div>
                <div class="tagline">Abstraction &amp; Reasoning Corpus</div>
                <div class="spacer"></div>
                <button
                    class="kb-help-btn"
                    id="btn-kb-help"
                    title="Keyboard Shortcuts"
                >
                    ‚å® Shortcuts
                </button>
                <button
                    class="top-btn top-btn-admin"
                    id="btn-admin"
                    title="Admin Panel"
                >
                    üîí Admin
                </button>
                <button
                    class="top-btn top-btn-logout"
                    id="btn-logout"
                    style="display: none"
                >
                    Logout
                </button>
            </div>

            <!-- ‚ïê‚ïê‚ïê ADMIN LOGIN MODAL ‚ïê‚ïê‚ïê -->
            <div id="admin-modal">
                <div class="admin-box">
                    <h2>üîí ADMIN LOGIN</h2>
                    <input
                        type="text"
                        class="admin-input"
                        id="admin-user"
                        placeholder="Username"
                        autocomplete="off"
                    />
                    <input
                        type="password"
                        class="admin-input"
                        id="admin-pass"
                        placeholder="Password"
                    />
                    <button class="admin-submit" id="admin-login-btn">
                        AUTHENTICATE
                    </button>
                    <div class="admin-status" id="admin-status"></div>
                    <button class="admin-cancel" id="admin-cancel">
                        Cancel
                    </button>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê KEYBOARD HELP PANEL ‚ïê‚ïê‚ïê -->
            <div id="kb-panel">
                <div class="kb-box">
                    <h2>‚å® KEYBOARD SHORTCUTS</h2>
                    <div class="kb-grid">
                        <div class="kb-section-title">Navigation</div>
                        <span class="kb-key">‚Üê ‚Üí</span>
                        <span class="kb-desc"
                            >Scroll carousel left / right</span
                        >
                        <span class="kb-key">[ ]</span>
                        <span class="kb-desc"
                            >Previous / Next page (AGI-2)</span
                        >
                        <span class="kb-key">1 2 3</span>
                        <span class="kb-desc"
                            >Switch AGI-2 tab (My Tasks / Training / Eval)</span
                        >
                        <div class="kb-section-title">Actions</div>
                        <span class="kb-key">R</span>
                        <span class="kb-desc">Open random task or game</span>
                        <span class="kb-key">/</span>
                        <span class="kb-desc">Focus search box</span>
                        <div class="kb-section-title">Interface</div>
                        <span class="kb-key">?</span>
                        <span class="kb-desc">Toggle this help panel</span>
                        <span class="kb-key">Esc</span>
                        <span class="kb-desc">Close modal / panel</span>
                    </div>
                    <button class="kb-close" id="kb-close">
                        Press <strong>?</strong> or <strong>Esc</strong> to
                        close
                    </button>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê -->
            <div id="toast"></div>

            <!-- ‚ïê‚ïê‚ïê CONTENT ‚ïê‚ïê‚ïê -->
            <div id="content">
                <!-- ‚îÄ‚îÄ TOP: AGI-2 Puzzles ‚îÄ‚îÄ -->
                <div class="section-panel" id="panel-agi2">
                    <div class="section-header">
                        <span class="section-badge badge-purple">AGI-2</span>
                        <div class="section-title-group">
                            <span class="section-title">ARC Puzzles</span>
                            <span class="section-subtitle">
                                <span id="agi2-count"></span>
                                <span style="color: #333">¬∑</span>
                                Classic pattern recognition
                            </span>
                        </div>
                        <div class="cat-tabs" id="agi2-tabs">
                            <button class="cat-tab active" data-cat="my_tasks">
                                ‚òÖ My Tasks
                                <span class="ct-count" id="ct-my_tasks">0</span>
                            </button>
                            <button class="cat-tab" data-cat="training">
                                Training
                                <span class="ct-count" id="ct-training">0</span>
                            </button>
                            <button class="cat-tab" data-cat="evaluation">
                                Evaluation
                                <span class="ct-count" id="ct-evaluation"
                                    >0</span
                                >
                            </button>
                        </div>
                        <div class="section-controls">
                            <input
                                type="text"
                                class="search-box"
                                id="agi2-search"
                                placeholder="Search task ID‚Ä¶"
                            />
                            <button
                                class="random-btn"
                                id="agi2-random"
                                title="Random puzzle"
                            >
                                üé≤
                                <span class="random-tooltip"
                                    >Random puzzle (R)</span
                                >
                            </button>
                            <label class="upload-btn" for="agi2-upload">
                                ‚Üë Upload .json
                                <input
                                    type="file"
                                    id="agi2-upload"
                                    accept=".json"
                                />
                            </label>
                            <div
                                class="pag-row"
                                id="agi2-pag"
                                style="display: none"
                            >
                                <button class="pag-btn" id="agi2-prev">
                                    ‚Üê
                                </button>
                                <span
                                    class="pag-info"
                                    id="agi2-pag-info"
                                ></span>
                                <button class="pag-btn" id="agi2-next">
                                    ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-wrapper">
                        <button
                            class="carousel-btn"
                            id="agi2-left"
                            title="Scroll left"
                        >
                            ‚Äπ
                        </button>
                        <div class="carousel-track" id="agi2-track"></div>
                        <button
                            class="carousel-btn"
                            id="agi2-right"
                            title="Scroll right"
                        >
                            ‚Ä∫
                        </button>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ DIVIDER ‚îÄ‚îÄ -->
                <div class="section-divider"></div>

                <!-- ‚îÄ‚îÄ BOTTOM: AGI-3 Games ‚îÄ‚îÄ -->
                <div class="section-panel" id="panel-agi3">
                    <div class="section-header">
                        <span class="section-badge badge-green">AGI-3</span>
                        <div class="section-title-group">
                            <span class="section-title">Interactive Games</span>
                            <span class="section-subtitle">
                                <span id="agi3-count"></span>
                                <span style="color: #333">¬∑</span>
                                Real-time game environments
                            </span>
                        </div>
                        <div class="section-desc">
                            Keyboard controls, multiple levels, instant
                            feedback.
                        </div>
                        <div class="section-controls">
                            <input
                                type="text"
                                class="search-box"
                                id="agi3-search"
                                placeholder="Search game ID‚Ä¶"
                            />
                            <button
                                class="random-btn"
                                id="agi3-random"
                                title="Random game"
                            >
                                üé≤
                                <span class="random-tooltip"
                                    >Random game (R)</span
                                >
                            </button>
                            <label class="upload-btn" for="agi3-upload">
                                ‚Üë Upload game
                                <input
                                    type="file"
                                    id="agi3-upload"
                                    accept=".py,.json"
                                    multiple
                                />
                            </label>
                        </div>
                    </div>
                    <div class="carousel-wrapper">
                        <button
                            class="carousel-btn"
                            id="agi3-left"
                            title="Scroll left"
                        >
                            ‚Äπ
                        </button>
                        <div class="carousel-track" id="agi3-track"></div>
                        <button
                            class="carousel-btn"
                            id="agi3-right"
                            title="Scroll right"
                        >
                            ‚Ä∫
                        </button>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê -->
            <div id="footer">
                Powered by
                <a href="https://ethara.ai" target="_blank">Ethara AI</a> ¬∑
                <a
                    href="https://github.com/Raj602-stack/Arc-Agi3"
                    target="_blank"
                    >GitHub</a
                >
                ¬∑ Press
                <kbd
                    style="
                        font-family: var(--code);
                        font-size: 9px;
                        background: var(--bg);
                        border: 1px solid var(--border);
                        border-radius: 3px;
                        padding: 1px 5px;
                        color: var(--text);
                    "
                    >?</kbd
                >
                for shortcuts
            </div>
        </div>

        <script>
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            //  Unified Landing Page ‚Äî AGI-2 (top) + AGI-3 (bottom)
            //  Horizontal carousel layout, direct game launch on click
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            // ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            var agi2Index = null;
            var agi2Category = "my_tasks";
            var agi2Search = "";
            var agi2Page = 0;
            var AGI2_PER_PAGE = 40;

            var agi3Games = [];
            var agi3Search = "";

            // ‚îÄ‚îÄ DOM refs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            var agi2Track = document.getElementById("agi2-track");
            var agi2Pag = document.getElementById("agi2-pag");
            var agi3Track = document.getElementById("agi3-track");

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            //  CAROUSEL HELPERS
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            function setupCarousel(trackId, leftBtnId, rightBtnId) {
                var track = document.getElementById(trackId);
                var leftBtn = document.getElementById(leftBtnId);
                var rightBtn = document.getElementById(rightBtnId);

                function updateButtons() {
                    var maxScroll = track.scrollWidth - track.clientWidth;
                    var overflows = maxScroll > 4;

                    if (overflows) {
                        track.classList.add("has-overflow");
                    } else {
                        track.classList.remove("has-overflow");
                    }

                    leftBtn.disabled = track.scrollLeft <= 2;
                    rightBtn.disabled =
                        !overflows || track.scrollLeft >= maxScroll - 2;

                    // Hide arrows entirely if no overflow
                    leftBtn.style.visibility = overflows ? "" : "hidden";
                    rightBtn.style.visibility = overflows ? "" : "hidden";
                }

                function scrollBy(dir) {
                    var amount = track.clientWidth * 0.7;
                    track.scrollBy({
                        left: dir * amount,
                        behavior: "smooth",
                    });
                }

                leftBtn.addEventListener("click", function () {
                    scrollBy(-1);
                });
                rightBtn.addEventListener("click", function () {
                    scrollBy(1);
                });

                track.addEventListener("scroll", updateButtons);
                window.addEventListener("resize", updateButtons);

                // Initial state
                setTimeout(updateButtons, 150);

                return { track: track, updateButtons: updateButtons };
            }

            var agi2Carousel = setupCarousel(
                "agi2-track",
                "agi2-left",
                "agi2-right",
            );
            var agi3Carousel = setupCarousel(
                "agi3-track",
                "agi3-left",
                "agi3-right",
            );

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            //  AGI-3 ‚Äî Fetch games and render cards
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            function fetchAgi3Games() {
                fetch("/api/games")
                    .then(function (r) {
                        return r.json();
                    })
                    .then(function (data) {
                        agi3Games = data.games || [];
                        document.getElementById("agi3-count").textContent =
                            agi3Games.length +
                            " game" +
                            (agi3Games.length !== 1 ? "s" : "");
                        renderAgi3();
                    })
                    .catch(function (err) {
                        agi3Track.innerHTML =
                            '<div class="empty-msg">Could not load games.<br>' +
                            err +
                            "</div>";
                    });
            }

            function renderAgi3() {
                var q = agi3Search.toLowerCase();
                var filtered = agi3Games.filter(function (g) {
                    return (
                        !q ||
                        g.game_id.toLowerCase().indexOf(q) !== -1 ||
                        (g.tags || []).join(" ").toLowerCase().indexOf(q) !== -1
                    );
                });

                agi3Track.innerHTML = "";

                if (filtered.length === 0) {
                    agi3Track.innerHTML = q
                        ? '<div class="empty-msg">No games match \u201c<code>' +
                          agi3Search +
                          "</code>\u201d</div>"
                        : '<div class="empty-msg">No games found.<br>Drop a game into <code>environment_files/</code> or use Upload.</div>';
                    agi3Carousel.updateButtons();
                    return;
                }

                filtered.forEach(function (g, _idx) {
                    var card = document.createElement("div");
                    card.className = "g-card agi3-card card-enter";
                    card.style.animationDelay = _idx * 0.04 + "s";

                    // Admin delete button
                    var delBtn = document.createElement("button");
                    delBtn.className = "card-delete-btn";
                    delBtn.textContent = "‚úï";
                    delBtn.title = "Delete " + g.game_id;
                    (function (gid, el) {
                        delBtn.addEventListener("click", function (e) {
                            e.stopPropagation();
                            deleteAgi3Game(gid, el);
                        });
                    })(g.game_id, card);
                    card.appendChild(delBtn);

                    var previewDiv = document.createElement("div");
                    previewDiv.className = "g-card-preview";
                    previewDiv.innerHTML =
                        '<div class="loading-text">LOADING\u2026</div>';

                    var overlay = document.createElement("div");
                    overlay.className = "card-overlay";
                    overlay.innerHTML =
                        '<div class="play-circle agi3-play">\u25B6</div>';
                    previewDiv.appendChild(overlay);

                    var img = new Image();
                    img.onload = function () {
                        var lt = previewDiv.querySelector(".loading-text");
                        if (lt) lt.remove();
                        previewDiv.insertBefore(img, previewDiv.firstChild);
                    };
                    img.onerror = function () {
                        var lt = previewDiv.querySelector(".loading-text");
                        if (lt) lt.textContent = "NO PREVIEW";
                    };
                    img.src =
                        "/api/games/" +
                        encodeURIComponent(g.game_id) +
                        "/preview";

                    var info = document.createElement("div");
                    info.className = "g-card-info";

                    var idEl = document.createElement("div");
                    idEl.className = "g-card-id";
                    idEl.textContent = g.game_id;

                    var tagsEl = document.createElement("div");
                    tagsEl.className = "g-card-tags";
                    (g.tags || []).forEach(function (t) {
                        var tag = document.createElement("span");
                        tag.className = "g-tag";
                        tag.textContent = t;
                        tagsEl.appendChild(tag);
                    });

                    info.appendChild(idEl);
                    if ((g.tags || []).length) info.appendChild(tagsEl);

                    card.appendChild(previewDiv);
                    card.appendChild(info);

                    // Click ‚Üí directly open and play the game
                    card.addEventListener("click", function () {
                        window.location.href =
                            "/arc-agi-3/game/" + encodeURIComponent(g.game_id);
                    });

                    agi3Track.appendChild(card);
                });

                setTimeout(function () {
                    agi3Carousel.updateButtons();
                }, 80);
            }

            // ‚îÄ‚îÄ AGI-3 Search ‚îÄ‚îÄ
            document
                .getElementById("agi3-search")
                .addEventListener("input", function () {
                    agi3Search = this.value.trim();
                    renderAgi3();
                });

            // ‚îÄ‚îÄ AGI-3 Upload ‚îÄ‚îÄ
            document
                .getElementById("agi3-upload")
                .addEventListener("change", function (e) {
                    var files = e.target.files;
                    if (!files || files.length === 0) return;

                    var form = new FormData();
                    for (var i = 0; i < files.length; i++) {
                        var name = files[i].name;
                        if (name.endsWith(".py"))
                            form.append("game_py", files[i]);
                        if (name.endsWith(".json"))
                            form.append("metadata_json", files[i]);
                    }

                    fetch("/api/upload", { method: "POST", body: form })
                        .then(function (r) {
                            return r.json();
                        })
                        .then(function (data) {
                            if (data.error) {
                                alert("Upload error: " + data.error);
                            } else {
                                alert(
                                    "Game uploaded: " + (data.game_id || "OK"),
                                );
                                fetchAgi3Games();
                            }
                        })
                        .catch(function (err) {
                            alert("Upload failed: " + err);
                        });

                    e.target.value = "";
                });

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            //  AGI-2 ‚Äî Fetch task index and render cards
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            function fetchAgi2Index() {
                fetch("/api/agi2/tasks")
                    .then(function (r) {
                        return r.json();
                    })
                    .then(function (data) {
                        agi2Index = data;
                        updateAgi2TabCounts();
                        renderAgi2();
                    })
                    .catch(function (err) {
                        agi2Track.innerHTML =
                            '<div class="empty-msg">Could not load task index.<br>' +
                            err +
                            "</div>";
                    });
            }

            function updateAgi2TabCounts() {
                if (!agi2Index) return;
                var cats = ["my_tasks", "training", "evaluation"];
                var total = 0;
                cats.forEach(function (c) {
                    var arr = agi2Index[c] || [];
                    total += arr.length;
                    var el = document.getElementById("ct-" + c);
                    if (el) el.textContent = arr.length;
                });
                document.getElementById("agi2-count").textContent =
                    total + " puzzles";
            }

            function getAgi2Files() {
                if (!agi2Index) return [];
                var files = agi2Index[agi2Category] || [];
                if (agi2Search) {
                    var q = agi2Search.toLowerCase();
                    files = files.filter(function (f) {
                        return f.toLowerCase().indexOf(q) !== -1;
                    });
                }
                return files;
            }

            function renderAgi2() {
                agi2Track.innerHTML = "";

                var files = getAgi2Files();

                // Update count display for filtered
                if (agi2Search) {
                    document.getElementById("agi2-count").textContent =
                        files.length +
                        " result" +
                        (files.length !== 1 ? "s" : "");
                } else {
                    updateAgi2TabCounts();
                }

                // Pagination
                var totalPages = Math.max(
                    1,
                    Math.ceil(files.length / AGI2_PER_PAGE),
                );
                if (agi2Page >= totalPages) agi2Page = totalPages - 1;
                if (agi2Page < 0) agi2Page = 0;

                var start = agi2Page * AGI2_PER_PAGE;
                var end = Math.min(start + AGI2_PER_PAGE, files.length);
                var pageFiles = files.slice(start, end);

                if (files.length === 0) {
                    agi2Track.innerHTML = agi2Search
                        ? '<div class="empty-msg">No tasks match \u201c<code>' +
                          agi2Search +
                          "</code>\u201d</div>"
                        : '<div class="empty-msg">No tasks in this category.</div>';
                    agi2Pag.style.display = "none";
                    agi2Carousel.updateButtons();
                    return;
                }

                // Show/hide pagination
                if (totalPages > 1) {
                    agi2Pag.style.display = "flex";
                    document.getElementById("agi2-pag-info").textContent =
                        agi2Page + 1 + "/" + totalPages;
                    document.getElementById("agi2-prev").disabled =
                        agi2Page === 0;
                    document.getElementById("agi2-next").disabled =
                        agi2Page >= totalPages - 1;
                } else {
                    agi2Pag.style.display = "none";
                }

                pageFiles.forEach(function (filename, i) {
                    var card = buildAgi2Card(filename, start + i);
                    card.classList.add("card-enter");
                    card.style.animationDelay = i * 0.04 + "s";
                    agi2Track.appendChild(card);
                });

                // Reset scroll position for new page
                agi2Track.scrollLeft = 0;
                setTimeout(function () {
                    agi2Carousel.updateButtons();
                }, 80);
            }

            function buildAgi2Card(filename, globalIdx) {
                var card = document.createElement("div");
                card.className = "g-card agi2-card";

                var taskId = filename.replace(".json", "");

                // Preview
                // Admin delete button
                var delBtn = document.createElement("button");
                delBtn.className = "card-delete-btn";
                delBtn.textContent = "‚úï";
                delBtn.title = "Delete " + taskId;
                (function (cat, fn, el) {
                    delBtn.addEventListener("click", function (e) {
                        e.stopPropagation();
                        deleteAgi2Task(cat, fn, el);
                    });
                })(agi2Category, filename, card);
                card.appendChild(delBtn);

                var previewDiv = document.createElement("div");
                previewDiv.className = "g-card-preview";
                previewDiv.innerHTML =
                    '<div class="loading-text">LOADING\u2026</div>';

                var overlay = document.createElement("div");
                overlay.className = "card-overlay";
                overlay.innerHTML =
                    '<div class="play-circle agi2-play">\u25B6</div>';
                previewDiv.appendChild(overlay);

                var img = new Image();
                img.onload = function () {
                    var lt = previewDiv.querySelector(".loading-text");
                    if (lt) lt.remove();
                    previewDiv.insertBefore(img, previewDiv.firstChild);
                };
                img.onerror = function () {
                    var lt = previewDiv.querySelector(".loading-text");
                    if (lt) lt.textContent = "NO PREVIEW";
                };
                img.src =
                    "/api/agi2/task-preview/" +
                    encodeURIComponent(agi2Category) +
                    "/" +
                    encodeURIComponent(filename);

                // Info
                var info = document.createElement("div");
                info.className = "g-card-info";

                var idEl = document.createElement("div");
                idEl.className = "g-card-id";
                idEl.textContent = taskId;

                var tagsEl = document.createElement("div");
                tagsEl.className = "g-card-tags";

                var catTag = document.createElement("span");
                catTag.className = "g-tag";
                catTag.textContent =
                    agi2Category === "my_tasks" ? "my task" : agi2Category;
                tagsEl.appendChild(catTag);

                info.appendChild(idEl);
                info.appendChild(tagsEl);

                card.appendChild(previewDiv);
                card.appendChild(info);

                // Click ‚Üí open AGI-2 directly with this task
                card.addEventListener("click", function () {
                    window.location.href =
                        "/arc-agi-2/?task=" +
                        encodeURIComponent(agi2Category) +
                        "/" +
                        encodeURIComponent(filename);
                });

                return card;
            }

            // ‚îÄ‚îÄ AGI-2 Tab switching ‚îÄ‚îÄ
            document
                .getElementById("agi2-tabs")
                .addEventListener("click", function (e) {
                    var btn = e.target.closest(".cat-tab");
                    if (!btn) return;
                    var cat = btn.getAttribute("data-cat");
                    if (cat === agi2Category) return;

                    document
                        .querySelectorAll("#agi2-tabs .cat-tab")
                        .forEach(function (t) {
                            t.classList.remove("active");
                        });
                    btn.classList.add("active");

                    agi2Category = cat;
                    agi2Page = 0;
                    renderAgi2();
                });

            // ‚îÄ‚îÄ AGI-2 Search (debounced) ‚îÄ‚îÄ
            (function () {
                var timer = null;
                document
                    .getElementById("agi2-search")
                    .addEventListener("input", function () {
                        var val = this.value.trim();
                        clearTimeout(timer);
                        timer = setTimeout(function () {
                            agi2Search = val;
                            agi2Page = 0;
                            renderAgi2();
                        }, 200);
                    });
            })();

            // ‚îÄ‚îÄ AGI-2 Pagination ‚îÄ‚îÄ
            document
                .getElementById("agi2-prev")
                .addEventListener("click", function () {
                    if (agi2Page > 0) {
                        agi2Page--;
                        renderAgi2();
                    }
                });
            document
                .getElementById("agi2-next")
                .addEventListener("click", function () {
                    var files = getAgi2Files();
                    var totalPages = Math.ceil(files.length / AGI2_PER_PAGE);
                    if (agi2Page < totalPages - 1) {
                        agi2Page++;
                        renderAgi2();
                    }
                });

            // ‚îÄ‚îÄ AGI-2 Upload ‚îÄ‚îÄ
            document
                .getElementById("agi2-upload")
                .addEventListener("change", function (e) {
                    var file = e.target.files[0];
                    if (!file) return;

                    if (!file.name.endsWith(".json")) {
                        alert("Please upload a .json task file.");
                        e.target.value = "";
                        return;
                    }

                    var reader = new FileReader();
                    reader.onload = function (ev) {
                        try {
                            var data = JSON.parse(ev.target.result);
                            if (!data.train || !data.test)
                                throw new Error("Missing train/test");
                            sessionStorage.setItem(
                                "agi2_upload_task",
                                ev.target.result,
                            );
                            sessionStorage.setItem(
                                "agi2_upload_name",
                                file.name,
                            );
                            window.location.href = "/arc-agi-2/?uploaded=1";
                        } catch (err) {
                            alert("Invalid task file: " + err.message);
                        }
                    };
                    reader.readAsText(file);
                    e.target.value = "";
                });

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            //  TOAST
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            var _toastTimer = null;
            function showToast(msg, type, ms) {
                ms = ms || 2500;
                var el = document.getElementById("toast");
                el.textContent = msg;
                el.className = "show" + (type ? " toast-" + type : "");
                clearTimeout(_toastTimer);
                _toastTimer = setTimeout(function () {
                    el.className = "";
                }, ms);
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            //  ADMIN ‚Äî login, logout, delete
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            var adminCreds = { username: null, password: null };
            var adminLoggedIn = false;

            var adminModal = document.getElementById("admin-modal");
            var adminUserEl = document.getElementById("admin-user");
            var adminPassEl = document.getElementById("admin-pass");
            var adminStatusEl = document.getElementById("admin-status");
            var adminLoginBtn = document.getElementById("admin-login-btn");
            var btnAdmin = document.getElementById("btn-admin");
            var btnLogout = document.getElementById("btn-logout");

            btnAdmin.addEventListener("click", function () {
                if (adminLoggedIn) {
                    // Toggle admin mode off
                    adminLogout();
                } else {
                    adminModal.classList.add("show");
                    adminUserEl.value = "";
                    adminPassEl.value = "";
                    adminStatusEl.textContent = "";
                    adminUserEl.focus();
                }
            });

            document
                .getElementById("admin-cancel")
                .addEventListener("click", function () {
                    adminModal.classList.remove("show");
                });

            adminModal.addEventListener("click", function (e) {
                if (e.target === adminModal)
                    adminModal.classList.remove("show");
            });

            adminPassEl.addEventListener("keydown", function (e) {
                if (e.key === "Enter") doAdminLogin();
            });
            adminUserEl.addEventListener("keydown", function (e) {
                if (e.key === "Enter") adminPassEl.focus();
            });
            adminLoginBtn.addEventListener("click", doAdminLogin);

            function doAdminLogin() {
                var user = adminUserEl.value.trim();
                var pass = adminPassEl.value;
                if (!user || !pass) {
                    adminStatusEl.textContent = "Enter username and password";
                    adminStatusEl.className = "admin-status err";
                    return;
                }
                adminLoginBtn.disabled = true;
                adminStatusEl.textContent = "Authenticating‚Ä¶";
                adminStatusEl.className = "admin-status";

                fetch("/api/admin/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username: user, password: pass }),
                })
                    .then(function (r) {
                        return r.json().then(function (d) {
                            return { ok: r.ok, data: d };
                        });
                    })
                    .then(function (res) {
                        adminLoginBtn.disabled = false;
                        if (res.ok) {
                            adminCreds = { username: user, password: pass };
                            adminLoggedIn = true;
                            try {
                                localStorage.setItem(
                                    "arc_admin",
                                    JSON.stringify(adminCreds),
                                );
                            } catch (e) {}
                            adminModal.classList.remove("show");
                            document.body.classList.add("admin-mode");
                            btnAdmin.classList.add("active");
                            btnAdmin.textContent = "üîì Admin ON";
                            btnLogout.style.display = "";
                            showToast(
                                "Admin mode enabled ‚Äî click ‚úï on any card to delete",
                                "ok",
                                3500,
                            );
                        } else {
                            adminStatusEl.textContent =
                                "‚úó " + (res.data.error || "Login failed");
                            adminStatusEl.className = "admin-status err";
                        }
                    })
                    .catch(function (e) {
                        adminLoginBtn.disabled = false;
                        adminStatusEl.textContent = "‚úó " + e.message;
                        adminStatusEl.className = "admin-status err";
                    });
            }

            btnLogout.addEventListener("click", adminLogout);

            function adminLogout() {
                adminCreds = { username: null, password: null };
                adminLoggedIn = false;
                try {
                    localStorage.removeItem("arc_admin");
                } catch (e) {}
                document.body.classList.remove("admin-mode");
                btnAdmin.classList.remove("active");
                btnAdmin.textContent = "üîí Admin";
                btnLogout.style.display = "none";
                showToast("Admin mode disabled", "", 1500);
            }

            // ‚îÄ‚îÄ Delete AGI-3 game ‚îÄ‚îÄ
            function deleteAgi3Game(gameId, cardEl) {
                if (
                    !confirm(
                        'Delete game "' + gameId + '"?\nThis cannot be undone.',
                    )
                )
                    return;
                var delBtn = cardEl.querySelector(".card-delete-btn");
                if (delBtn) {
                    delBtn.textContent = "‚Ä¶";
                    delBtn.style.pointerEvents = "none";
                }

                fetch("/api/admin/games/" + encodeURIComponent(gameId), {
                    method: "DELETE",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        username: adminCreds.username,
                        password: adminCreds.password,
                    }),
                })
                    .then(function (r) {
                        return r.json().then(function (d) {
                            return { ok: r.ok, data: d };
                        });
                    })
                    .then(function (res) {
                        if (res.ok) {
                            cardEl.style.transition = "all 0.3s";
                            cardEl.style.opacity = "0";
                            cardEl.style.transform = "scale(0.8)";
                            setTimeout(function () {
                                cardEl.remove();
                                agi3Carousel.updateButtons();
                            }, 300);
                            showToast("Deleted game: " + gameId, "ok");
                            // Refresh game list
                            fetchAgi3Games();
                        } else {
                            showToast(
                                "Error: " + (res.data.error || "Delete failed"),
                                "err",
                                4000,
                            );
                            if (delBtn) {
                                delBtn.textContent = "‚úï";
                                delBtn.style.pointerEvents = "";
                            }
                        }
                    })
                    .catch(function (e) {
                        showToast("Error: " + e.message, "err", 4000);
                        if (delBtn) {
                            delBtn.textContent = "‚úï";
                            delBtn.style.pointerEvents = "";
                        }
                    });
            }

            // ‚îÄ‚îÄ Delete AGI-2 task ‚îÄ‚îÄ
            function deleteAgi2Task(category, filename, cardEl) {
                if (
                    !confirm(
                        'Delete task "' +
                            filename.replace(".json", "") +
                            '" from ' +
                            category +
                            "?\nThis cannot be undone.",
                    )
                )
                    return;
                var delBtn = cardEl.querySelector(".card-delete-btn");
                if (delBtn) {
                    delBtn.textContent = "‚Ä¶";
                    delBtn.style.pointerEvents = "none";
                }

                fetch(
                    "/api/admin/agi2/tasks/" +
                        encodeURIComponent(category) +
                        "/" +
                        encodeURIComponent(filename),
                    {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            username: adminCreds.username,
                            password: adminCreds.password,
                        }),
                    },
                )
                    .then(function (r) {
                        return r.json().then(function (d) {
                            return { ok: r.ok, data: d };
                        });
                    })
                    .then(function (res) {
                        if (res.ok) {
                            cardEl.style.transition = "all 0.3s";
                            cardEl.style.opacity = "0";
                            cardEl.style.transform = "scale(0.8)";
                            setTimeout(function () {
                                cardEl.remove();
                                agi2Carousel.updateButtons();
                            }, 300);
                            showToast(
                                "Deleted task: " +
                                    filename.replace(".json", ""),
                                "ok",
                            );
                            // Refresh task index
                            fetchAgi2Index();
                        } else {
                            showToast(
                                "Error: " + (res.data.error || "Delete failed"),
                                "err",
                                4000,
                            );
                            if (delBtn) {
                                delBtn.textContent = "‚úï";
                                delBtn.style.pointerEvents = "";
                            }
                        }
                    })
                    .catch(function (e) {
                        showToast("Error: " + e.message, "err", 4000);
                        if (delBtn) {
                            delBtn.textContent = "‚úï";
                            delBtn.style.pointerEvents = "";
                        }
                    });
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            //  RANDOM TASK / GAME
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            function randomAgi2Task() {
                if (!agi2Index) {
                    showToast("Tasks not loaded yet", "err");
                    return;
                }
                var cats = ["my_tasks", "training", "evaluation"];
                var allFiles = [];
                cats.forEach(function (c) {
                    (agi2Index[c] || []).forEach(function (f) {
                        allFiles.push({ cat: c, file: f });
                    });
                });
                if (allFiles.length === 0) {
                    showToast("No tasks available", "err");
                    return;
                }
                var pick =
                    allFiles[Math.floor(Math.random() * allFiles.length)];
                showToast(
                    "\uD83C\uDFB2 Random: " + pick.file.replace(".json", ""),
                    "ok",
                    1500,
                );
                setTimeout(function () {
                    window.location.href =
                        "/arc-agi-2/?task=" +
                        encodeURIComponent(pick.cat) +
                        "/" +
                        encodeURIComponent(pick.file);
                }, 400);
            }

            function randomAgi3Game() {
                if (agi3Games.length === 0) {
                    showToast("No games available", "err");
                    return;
                }
                var pick =
                    agi3Games[Math.floor(Math.random() * agi3Games.length)];
                showToast("\uD83C\uDFB2 Random: " + pick.game_id, "ok", 1500);
                setTimeout(function () {
                    window.location.href =
                        "/arc-agi-3/game/" + encodeURIComponent(pick.game_id);
                }, 400);
            }

            document
                .getElementById("agi2-random")
                .addEventListener("click", randomAgi2Task);
            document
                .getElementById("agi3-random")
                .addEventListener("click", randomAgi3Game);

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            //  KEYBOARD HELP PANEL
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            var kbPanel = document.getElementById("kb-panel");

            document
                .getElementById("btn-kb-help")
                .addEventListener("click", function () {
                    kbPanel.classList.toggle("show");
                });
            document
                .getElementById("kb-close")
                .addEventListener("click", function () {
                    kbPanel.classList.remove("show");
                });
            kbPanel.addEventListener("click", function (e) {
                if (e.target === kbPanel) kbPanel.classList.remove("show");
            });

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            //  KEYBOARD SHORTCUTS
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            document.addEventListener("keydown", function (e) {
                var tag = (e.target.tagName || "").toLowerCase();
                var inInput =
                    tag === "input" || tag === "textarea" || tag === "select";

                // ESC ‚Äî close any modal/panel
                if (e.key === "Escape") {
                    if (kbPanel.classList.contains("show")) {
                        kbPanel.classList.remove("show");
                        return;
                    }
                    if (adminModal.classList.contains("show")) {
                        adminModal.classList.remove("show");
                        return;
                    }
                    return;
                }

                // Skip other shortcuts if typing in an input
                if (inInput) return;

                // ? ‚Äî toggle keyboard help
                if (e.key === "?") {
                    e.preventDefault();
                    kbPanel.classList.toggle("show");
                    return;
                }

                // / ‚Äî focus search (AGI-2 by default)
                if (e.key === "/") {
                    e.preventDefault();
                    document.getElementById("agi2-search").focus();
                    return;
                }

                // R ‚Äî random task or game
                if (e.key === "r" || e.key === "R") {
                    if (Math.random() < 0.5 && agi3Games.length > 0) {
                        randomAgi3Game();
                    } else {
                        randomAgi2Task();
                    }
                    return;
                }

                // Arrow keys ‚Äî scroll both carousels
                if (e.key === "ArrowLeft") {
                    e.preventDefault();
                    document.getElementById("agi2-left").click();
                    document.getElementById("agi3-left").click();
                    return;
                }
                if (e.key === "ArrowRight") {
                    e.preventDefault();
                    document.getElementById("agi2-right").click();
                    document.getElementById("agi3-right").click();
                    return;
                }

                // [ ] ‚Äî AGI-2 pagination
                if (e.key === "[") {
                    e.preventDefault();
                    document.getElementById("agi2-prev").click();
                    return;
                }
                if (e.key === "]") {
                    e.preventDefault();
                    document.getElementById("agi2-next").click();
                    return;
                }

                // 1, 2, 3 ‚Äî switch AGI-2 category tabs
                if (e.key === "1") {
                    var t1 = document.querySelectorAll("#agi2-tabs .cat-tab");
                    if (t1[0]) t1[0].click();
                    return;
                }
                if (e.key === "2") {
                    var t2 = document.querySelectorAll("#agi2-tabs .cat-tab");
                    if (t2[1]) t2[1].click();
                    return;
                }
                if (e.key === "3") {
                    var t3 = document.querySelectorAll("#agi2-tabs .cat-tab");
                    if (t3[2]) t3[2].click();
                    return;
                }
            });

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            //  PERSISTENT ADMIN SESSION (localStorage)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            function restoreAdminSession() {
                try {
                    var saved = localStorage.getItem("arc_admin");
                    if (!saved) return;
                    var creds = JSON.parse(saved);
                    if (!creds.username || !creds.password) return;

                    // Verify credentials are still valid
                    fetch("/api/admin/login", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(creds),
                    })
                        .then(function (r) {
                            return r.json().then(function (d) {
                                return { ok: r.ok, data: d };
                            });
                        })
                        .then(function (res) {
                            if (res.ok) {
                                adminCreds = creds;
                                adminLoggedIn = true;
                                document.body.classList.add("admin-mode");
                                btnAdmin.classList.add("active");
                                btnAdmin.textContent = "\uD83D\uDD13 Admin ON";
                                btnLogout.style.display = "";
                            } else {
                                localStorage.removeItem("arc_admin");
                            }
                        })
                        .catch(function () {
                            // Silently fail on network error
                        });
                } catch (e) {
                    // localStorage not available
                }
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            //  INIT
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            fetchAgi3Games();
            fetchAgi2Index();
            restoreAdminSession();
        </script>
    </body>
</html>
